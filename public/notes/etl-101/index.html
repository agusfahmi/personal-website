<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Extract, Transform and Load (ETL) 101 |
Agus Fahmi Aji Pramana's Blogging Site
</title><meta name=keywords content><meta name=description content="
    Understanding the concept of Data Engineering"><meta name=author content="Agus Fahmi Aji Pramana"><link rel=canonical href=http://localhost:1313/notes/etl-101/><link crossorigin=anonymous href=/assets/css/stylesheet.606be4c20b063263aae99830f89a0f4bbedcc98a7b8fea0b216f60439a69a571.css integrity="sha256-YGvkwgsGMmOq6Zgw+JoPS77cyYp7j+oLIW9gQ5pppXE=" rel="preload stylesheet" as=style><link crossorigin=anonymous referrerpolicy=no-referrer rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="><link rel=icon href=http://localhost:1313/favicon.ico type=image/x-icon><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=manifest href=/site.webmanifest><link rel=icon type=image/png sizes=192x192 href=http://localhost:1313/img/android-chrome-192x192.png><link rel=icon type=image/png sizes=512x512 href=http://localhost:1313/img/android-chrome-512x512.png><link rel=apple-touch-icon href=http://localhost:1313/img/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/safari-pinned-tab.svg color=#2e2e33><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33
  "><link rel=alternate hreflang=en href=http://localhost:1313/notes/etl-101/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-PJ6VCR89GD"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PJ6VCR89GD")}</script><meta property="og:title" content="Extract, Transform and Load (ETL) 101"><meta property="og:description" content="Understanding the concept of Data Engineering"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/notes/etl-101/"><meta property="og:image" content="http://localhost:1313/logo.svg"><meta property="article:section" content="notes"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/logo.svg"><meta name=twitter:title content="Extract, Transform and Load (ETL) 101"><meta name=twitter:description content="Understanding the concept of Data Engineering"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Personal Notes, Learning, Self-Preparation","item":"http://localhost:1313/notes/"},{"@type":"ListItem","position":2,"name":"Extract, Transform and Load (ETL) 101","item":"http://localhost:1313/notes/etl-101/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Extract, Transform and Load (ETL) 101","name":"Extract, Transform and Load (ETL) 101","description":"Understanding the concept of Data Engineering","keywords":[],"articleBody":"Concepts Batch processing collection of data from multiple sources and combined to become a single source of information. a type of batch processing called Extract, Transform and Load (ETL) the process of extracting large amounts of data from multiple sources and formats and transforming it into one specific format before loading it into a database or target file. Block Diagram of ETL Extraction Python Composite Functions import glob import pandas as pd list_csv = glob.glob(\"*.csv\") list_json = glob.glob(\"*.json\") df_csv = pd.read_csv(\"source.csv\") df_json = pd.read_json(\"source.json\", lines=True) Extract Function def extract(): extracted_data = pd.DataFrame(columns=['name', 'height', 'weight']) for csvfile in glob.glob('*.csv'): extracted_data = extracted_data.append( pd.read_csv((csvfile), ignore_index=True ) for jsonfile in glob.glb(\"*.json\"): extracted_data = extracted_data.append( pd.read_json(jsonfile, lines=True), ignore_index=True ) return extracted_data If we did not set the parameter “ignore_index” to true, then the index of the data frame “extracted_data” would be the same as the row Number of the original file.\nIf we “ignore index” to true, then the order of each row would be the same as the order the row was appended to the data frame.\nTransform def transform(data): data['height'] = round(data.height * 0.0254, 2) data['weight'] = round(data.weight * 0.45359237, 2) return data Load def load(targetfile, data_to_laod): data_to_load.to_csv(targetfile) targetfile = 'transformed_data.csv' load(targetfile, transformed_data) Logging Entries from datatime from datetime def log(message): timestamp_format = \"%Y-%h-%d-%H:%M:%S\" now = datetime.now() timestamp = now.strftime(timestamp_format) with open(\"logfile.txt\", \"a\") as f: f.write (timestamp + ',' + message + '\\n') Hands-on Project The complex Extract, Transform, and Loading operations involves following steps:\nExtract relevant information from websites using Webscraping and requests API. Transform the data to a required format. Load the processed data to a local file or as a database table. Query the database table using Python. Create detailed logs of all operations conducted. Solutions Top Countries GDP - ETL Process \"\"\"Module: Code for ETL operations on Country-GDP data\"\"\" import os import sqlite3 import requests import numpy as np import pandas as pd from bs4 import BeautifulSoup from datetime import datetime os.system(\"clear\") WIKIPEDIA_GDP_URL = ( \"https://web.archive.org/web/20230902185326/https://en.wikipedia.org/wiki/List_of_countries_by_GDP_%28nominal%29\" ) TABLE_ATTRIBUTES = [\"Country\", \"GDP_USD_millions\"] DB_NAME = \"world_economies.db\" TABLE_NAME = \"countries_by_gdp\" CSV_PATH = \"countries_by_gdp.csv\" def extract(url, table_attributes): \"\"\" This function extracts the required information from the website and saves it to a dataframe. The function returns the dataframe for further processing. \"\"\" page_output = requests.get(url, timeout=10) html_soup = BeautifulSoup(page_output.text, \"html.parser\") gdp_df = pd.DataFrame(columns=table_attributes) tables = html_soup.find_all(\"tbody\") rows = tables[2].find_all(\"tr\") for row in rows: data = row.find_all(\"td\") if len(data) == 0: continue country = data[0].find(\"a\") gdp = data[2] if country is None or \"—\" in gdp: continue row_dict = {\"Country\": country.text, \"GDP_USD_millions\": gdp.text} row_df = pd.DataFrame(row_dict, index=[0]) gdp_df = pd.concat([gdp_df, row_df], ignore_index=[0]) return gdp_df def convert_currency_to_numeric(currency): \"\"\" This function converts the currency text into numeric form. \"\"\" return float(\"\".join(currency.split(\",\"))) def convert_millions_to_billions(millions): \"\"\" This function convert millions value to billions and round to 2 decimal places. \"\"\" return np.round(millions / 1000, 2) def transform(df): \"\"\" This function converts the GDP information from Currency format to float value, transforms the information of GDP from USD (Millions) to USD (Billions) rounding to 2 decimal places. The function returns the transformed dataframe. \"\"\" gdp_list = df[\"GDP_USD_millions\"].tolist() gdp_list = [convert_millions_to_billions(convert_currency_to_numeric(gdp_value)) for gdp_value in gdp_list] df[\"GDP_USD_millions\"] = gdp_list df = df.rename(columns={\"GDP_USD_millions\": \"GDP_USD_billions\"}) return df def load_to_csv(df, csv_path): \"\"\" This function saves the final dataframe as a `CSV` file in the provided path. Function returns nothing. \"\"\" df.to_csv(csv_path) def load_to_db(df, sql_connection, table_name): \"\"\" This function saves the final dataframe as a database table with the provided name. Function returns nothing. \"\"\" df.to_sql(table_name, sql_connection, if_exists=\"replace\", index=False) def run_query(statement, sql_connection): \"\"\" This function runs the stated query on the database table and prints the output on the terminal. Function returns nothing. \"\"\" print(\"Query Statement:\", statement) output = pd.read_sql(statement, sql_connection) print(\"Query Output:\", output) def log_progress(message): \"\"\" This function logs the mentioned message at a given stage of the code execution to a log file. Function returns nothing \"\"\" timestamp_format = \"%Y-%h-%d-%H:%M:%S\" now = datetime.now() timestamp = now.strftime(timestamp_format) with open(\"./code_log.txt\", \"a\") as f: f.write(timestamp + \" : \" + message + \"\\n\") if __name__ == \"__main__\": log_progress(\"Preliminaries complete. Initiating ETL process.\") extracted_data = extract(WIKIPEDIA_GDP_URL, TABLE_ATTRIBUTES) log_progress(\"Data Extraction complete. Initiating transformation process.\") transform_data = transform(extracted_data) log_progress(\"Data Transformation complete. Initiating loading process.\") load_to_csv(transform_data, \"gdp.csv\") log_progress(\"Data load to CSV file complete. Initiating SQL connection.\") sql_connection = sqlite3.connect(DB_NAME) log_progress(\"SQL Connection Initiated. Initiating loading process.\") load_to_db(transform_data, sql_connection, TABLE_NAME) log_progress(\"Data load to database complete. Running the query\") query_statement = f\"SELECT * from {TABLE_NAME} WHERE GDP_USD_billions \u003e= 100\" run_query(query_statement, sql_connection) log_progress(\"Run query complete. Closing SQL connection.\") sql_connection.close() log_progress('Process Complete. Connection Closed.') World top Banks - ETL Process \"\"\"Module: Code for ETL operations on Bank data\"\"\" import os import sqlite3 import requests import numpy as np import pandas as pd from bs4 import BeautifulSoup from datetime import datetime os.system(\"clear\") WIKIPEDIA_BANK_URL = \"https://web.archive.org/web/20230908091635/https://en.wikipedia.org/wiki/List_of_largest_banks\" TABLE_ATTRIBUTES = [\"Bank_Name\", \"USD_Billion\"] DB_NAME = \"banks.db\" TABLE_NAME = \"largest_banks\" CSV_PATH = \"banks.csv\" def extract(url, table_attributes): \"\"\" This function extracts the required information from the website and saves it to a dataframe. The function returns the dataframe for further processing. \"\"\" page_output = requests.get(url, timeout=10) html_soup = BeautifulSoup(page_output.text, \"html.parser\") bank_df = pd.DataFrame(columns=table_attributes) tables = html_soup.find_all(\"tbody\") rows = tables[0].find_all(\"tr\") for row in rows: data = row.find_all(\"td\") if not data: continue bank = data[1].find_all(\"a\") billion = data[2] row_dict = {\"Bank_Name\": bank[1].text, \"USD_Billion\": billion.text} row_df = pd.DataFrame(row_dict, index=[0]) bank_df = pd.concat([bank_df, row_df], ignore_index=[0]) return bank_df def convert_currency_to_numeric(currency): \"\"\" This function converts the currency text into numeric form. \"\"\" return float(\"\".join(currency.split(\",\"))) def transform(df): \"\"\" This function accesses the CSV file for exchange rate information, and adds three columns to the data frame, each containing the transformed version of Market Cap column to respective currencies \"\"\" currency_df = pd.read_csv(\"exchange_rate.csv\") exchange_rate = currency_df.set_index(\"Currency\").to_dict()[\"Value\"] df[\"USD_Billion\"] = [convert_currency_to_numeric(x) for x in df[\"USD_Billion\"]] df[\"GBP_Billion\"] = [np.round(x * exchange_rate[\"GBP\"], 2) for x in df[\"USD_Billion\"]] df[\"EUR_Billion\"] = [np.round(x * exchange_rate[\"EUR\"], 2) for x in df[\"USD_Billion\"]] df[\"NPR_Billion\"] = [np.round(x * exchange_rate[\"NPR\"], 2) for x in df[\"USD_Billion\"]] return df def load_to_csv(df, csv_path): \"\"\" This function saves the final data frame as a `CSV` file in the provided path. Function returns nothing. \"\"\" df.to_csv(csv_path) def load_to_db(df, sql_connection, table_name): \"\"\" This function saves the final data frame as a database table with the provided name. Function returns nothing. \"\"\" df.to_sql(table_name, sql_connection, if_exists=\"replace\", index=False) def run_query(statement, sql_connection): \"\"\" This function runs the stated query on the database table and prints the output on the terminal. Function returns nothing. \"\"\" print(\"Query Statement:\", statement) output = pd.read_sql(statement, sql_connection) print(\"Query Output:\", output) def log_progress(message): \"\"\" This function logs the mentioned message at a given stage of the code execution to a log file. Function returns nothing \"\"\" timestamp_format = \"%Y-%h-%d-%H:%M:%S\" now = datetime.now() timestamp = now.strftime(timestamp_format) with open(\"./code_log.txt\", \"a\") as f: f.write(timestamp + \" : \" + message + \"\\n\") if __name__ == \"__main__\": log_progress(\"Preliminaries complete. Initiating ETL process.\") extracted_data = extract(WIKIPEDIA_BANK_URL, TABLE_ATTRIBUTES) log_progress(\"Data Extraction complete. Initiating transformation process.\") transform_data = transform(extracted_data) log_progress(\"Data Transformation complete. Initiating loading process.\") load_to_csv(transform_data, \"banks.csv\") log_progress(\"Data load to CSV file complete. Initiating SQL connection.\") sql_connection = sqlite3.connect(DB_NAME) log_progress(\"SQL Connection Initiated. Initiating loading process.\") load_to_db(transform_data, sql_connection, TABLE_NAME) log_progress(\"Data load to database complete. Running the query\") query_statement = f\"SELECT * FROM {TABLE_NAME}\" run_query(query_statement, sql_connection) log_progress(\"Run query 1 complete. Closing SQL connection.\") query_statement = f\"SELECT AVG(NPR_Billion) FROM {TABLE_NAME}\" run_query(query_statement, sql_connection) log_progress(\"Run query 2 complete. Closing SQL connection.\") query_statement = f\"SELECT * FROM {TABLE_NAME} LIMIT 5\" run_query(query_statement, sql_connection) log_progress(\"Run query 3 complete. Closing SQL connection.\") sql_connection.close() log_progress(\"Process Complete. Connection Closed.\") ","wordCount":"1212","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"Agus Fahmi Aji Pramana"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/notes/etl-101/"},"publisher":{"@type":"Organization","name":"Agus Fahmi Aji Pramana's Blogging Site","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Agus Fahmi Aji Pramana (Alt + H)">Agus Fahmi Aji Pramana</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=http://localhost:1313/about-me title="About Me"><span>About Me</span></a></li><li><a href=http://localhost:1313/blogs title=Blogs><span>Blogs</span></a></li><li><a href=http://localhost:1313/projects title=Projects><span>Projects</span></a></li><li><a href=http://localhost:1313/slides title=Slides><span>Slides</span></a></li><li><a href=http://localhost:1313/honors title=Honors><span>Honors</span></a></li><li><a href=http://localhost:1313/search title="Search (Alt + /)" accesskey=/><i class="fa fa-search"></i></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/notes/>Personal Notes, Learning, Self-Preparation</a></div><h1 class="post-title entry-hint-parent">Extract, Transform and Load (ETL) 101</h1><div class=post-description>Understanding the concept of Data Engineering</div><div class=post-meta>6 min&nbsp;·&nbsp;1212 words&nbsp;·&nbsp;Agus Fahmi Aji Pramana</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Agenda</span></summary><div class=inner><ul><li><a href=#concepts aria-label=Concepts>Concepts</a></li><li><a href=#block-diagram-of-etl aria-label="Block Diagram of ETL">Block Diagram of ETL</a><ul><li><a href=#extraction aria-label=Extraction>Extraction</a><ul><li><a href=#python-composite-functions aria-label="Python Composite Functions">Python Composite Functions</a></li><li><a href=#extract-function aria-label="Extract Function">Extract Function</a></li></ul></li><li><a href=#transform aria-label=Transform>Transform</a></li><li><a href=#load aria-label=Load>Load</a></li><li><a href=#logging-entries aria-label="Logging Entries">Logging Entries</a></li></ul></li><li><a href=#hands-on-project aria-label="Hands-on Project">Hands-on Project</a><ul><li><a href=#solutions aria-label=Solutions>Solutions</a><ul><li><a href=#top-countries-gdp---etl-process aria-label="Top Countries GDP - ETL Process">Top Countries GDP - ETL Process</a></li><li><a href=#world-top-banks---etl-process aria-label="World top Banks - ETL Process">World top Banks - ETL Process</a></li></ul></li></ul></li></ul></div></details></div><div class=post-content><h2 id=concepts>Concepts<a hidden class=anchor aria-hidden=true href=#concepts>#</a></h2><p><input type=checkbox id=zoomCheck-6dae8 hidden>
<label for=zoomCheck-6dae8><img class=zoomCheck loading=lazy decoding=async src=img/batch-processing.webp alt="Batch Processing"></label></p><ul><li><strong>Batch processing</strong> collection of data from multiple sources and combined to become a single source of information.</li><li>a type of batch processing called <strong>Extract, Transform and Load (ETL)</strong></li><li>the process of extracting large amounts of data from multiple sources and formats and transforming it into <strong>one specific format</strong> before loading it into a database or target file.</li></ul><h2 id=block-diagram-of-etl>Block Diagram of ETL<a hidden class=anchor aria-hidden=true href=#block-diagram-of-etl>#</a></h2><p><input type=checkbox id=zoomCheck-29b5b hidden>
<label for=zoomCheck-29b5b><img class=zoomCheck loading=lazy decoding=async src=img/block-diagram-etl.webp alt="Block Diagram of ETL"></label></p><h3 id=extraction>Extraction<a hidden class=anchor aria-hidden=true href=#extraction>#</a></h3><h4 id=python-composite-functions>Python Composite Functions<a hidden class=anchor aria-hidden=true href=#python-composite-functions>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>import</span> <span class=nn>glob</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>list_csv</span> <span class=o>=</span> <span class=n>glob</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=s2>&#34;*.csv&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>list_json</span> <span class=o>=</span> <span class=n>glob</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=s2>&#34;*.json&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df_csv</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=s2>&#34;source.csv&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_json</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_json</span><span class=p>(</span><span class=s2>&#34;source.json&#34;</span><span class=p>,</span> <span class=n>lines</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=extract-function>Extract Function<a hidden class=anchor aria-hidden=true href=#extract-function>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=k>def</span> <span class=nf>extract</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>extracted_data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;height&#39;</span><span class=p>,</span> <span class=s1>&#39;weight&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>csvfile</span> <span class=ow>in</span> <span class=n>glob</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=s1>&#39;*.csv&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>extracted_data</span> <span class=o>=</span> <span class=n>extracted_data</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>((</span><span class=n>csvfile</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>ignore_index</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>jsonfile</span> <span class=ow>in</span> <span class=n>glob</span><span class=o>.</span><span class=n>glb</span><span class=p>(</span><span class=s2>&#34;*.json&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>extracted_data</span> <span class=o>=</span> <span class=n>extracted_data</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>pd</span><span class=o>.</span><span class=n>read_json</span><span class=p>(</span><span class=n>jsonfile</span><span class=p>,</span> <span class=n>lines</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>ignore_index</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>extracted_data</span>
</span></span></code></pre></div><blockquote><p>If we did not set the parameter “ignore_index” to true, then the index of the data frame “extracted_data” would be the same as the row Number of the original file.</p></blockquote><blockquote><p>If we “ignore index” to true, then the order of each row would be the same as the order the row was appended to the data frame.</p></blockquote><h3 id=transform>Transform<a hidden class=anchor aria-hidden=true href=#transform>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=k>def</span> <span class=nf>transform</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=p>[</span><span class=s1>&#39;height&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>round</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>height</span> <span class=o>*</span> <span class=mf>0.0254</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=p>[</span><span class=s1>&#39;weight&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>round</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>weight</span> <span class=o>*</span> <span class=mf>0.45359237</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>data</span>
</span></span></code></pre></div><h3 id=load>Load<a hidden class=anchor aria-hidden=true href=#load>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=k>def</span> <span class=nf>load</span><span class=p>(</span><span class=n>targetfile</span><span class=p>,</span> <span class=n>data_to_laod</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>data_to_load</span><span class=o>.</span><span class=n>to_csv</span><span class=p>(</span><span class=n>targetfile</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>targetfile</span> <span class=o>=</span> <span class=s1>&#39;transformed_data.csv&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>load</span><span class=p>(</span><span class=n>targetfile</span><span class=p>,</span> <span class=n>transformed_data</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=logging-entries>Logging Entries<a hidden class=anchor aria-hidden=true href=#logging-entries>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datatime</span> <span class=kn>from</span> <span class=nn>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>log</span><span class=p>(</span><span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp_format</span> <span class=o>=</span> <span class=s2>&#34;%Y-%h-</span><span class=si>%d</span><span class=s2>-%H:%M:%S&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>now</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span> <span class=o>=</span> <span class=n>now</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=n>timestamp_format</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;logfile.txt&#34;</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>write</span> <span class=p>(</span><span class=n>timestamp</span> <span class=o>+</span> <span class=s1>&#39;,&#39;</span> <span class=o>+</span> <span class=n>message</span> <span class=o>+</span> <span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=hands-on-project>Hands-on Project<a hidden class=anchor aria-hidden=true href=#hands-on-project>#</a></h2><p>The complex Extract, Transform, and Loading operations involves following steps:</p><ul><li>Extract relevant information from websites using Webscraping and requests API.</li><li>Transform the data to a required format.</li><li>Load the processed data to a local file or as a database table.</li><li>Query the database table using Python.</li><li>Create detailed logs of all operations conducted.</li></ul><h3 id=solutions>Solutions<a hidden class=anchor aria-hidden=true href=#solutions>#</a></h3><h4 id=top-countries-gdp---etl-process><a href=https://github.com/cham11ng/misc/tree/main/python/course/data-engineering/gdp>Top Countries GDP - ETL Process</a><a hidden class=anchor aria-hidden=true href=#top-countries-gdp---etl-process>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;Module: Code for ETL operations on Country-GDP data&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sqlite3</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>bs4</span> <span class=kn>import</span> <span class=n>BeautifulSoup</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=s2>&#34;clear&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>WIKIPEDIA_GDP_URL</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;https://web.archive.org/web/20230902185326/https://en.wikipedia.org/wiki/List_of_countries_by_GDP_%28nominal%29&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>TABLE_ATTRIBUTES</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;Country&#34;</span><span class=p>,</span> <span class=s2>&#34;GDP_USD_millions&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>DB_NAME</span> <span class=o>=</span> <span class=s2>&#34;world_economies.db&#34;</span>
</span></span><span class=line><span class=cl><span class=n>TABLE_NAME</span> <span class=o>=</span> <span class=s2>&#34;countries_by_gdp&#34;</span>
</span></span><span class=line><span class=cl><span class=n>CSV_PATH</span> <span class=o>=</span> <span class=s2>&#34;countries_by_gdp.csv&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>extract</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>table_attributes</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    This function extracts the required
</span></span></span><span class=line><span class=cl><span class=s2>    information from the website and saves it to a dataframe. The
</span></span></span><span class=line><span class=cl><span class=s2>    function returns the dataframe for further processing.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>page_output</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>html_soup</span> <span class=o>=</span> <span class=n>BeautifulSoup</span><span class=p>(</span><span class=n>page_output</span><span class=o>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;html.parser&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>gdp_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=n>table_attributes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>tables</span> <span class=o>=</span> <span class=n>html_soup</span><span class=o>.</span><span class=n>find_all</span><span class=p>(</span><span class=s2>&#34;tbody&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>rows</span> <span class=o>=</span> <span class=n>tables</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span><span class=n>find_all</span><span class=p>(</span><span class=s2>&#34;tr&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>rows</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>row</span><span class=o>.</span><span class=n>find_all</span><span class=p>(</span><span class=s2>&#34;td&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>country</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>gdp</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>country</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=s2>&#34;—&#34;</span> <span class=ow>in</span> <span class=n>gdp</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>row_dict</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;Country&#34;</span><span class=p>:</span> <span class=n>country</span><span class=o>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;GDP_USD_millions&#34;</span><span class=p>:</span> <span class=n>gdp</span><span class=o>.</span><span class=n>text</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>row_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>row_dict</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>gdp_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>([</span><span class=n>gdp_df</span><span class=p>,</span> <span class=n>row_df</span><span class=p>],</span> <span class=n>ignore_index</span><span class=o>=</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>gdp_df</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>convert_currency_to_numeric</span><span class=p>(</span><span class=n>currency</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    This function converts the currency text into numeric form.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>float</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>currency</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;,&#34;</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>convert_millions_to_billions</span><span class=p>(</span><span class=n>millions</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    This function convert millions value to billions and round
</span></span></span><span class=line><span class=cl><span class=s2>    to 2 decimal places.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>round</span><span class=p>(</span><span class=n>millions</span> <span class=o>/</span> <span class=mi>1000</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>transform</span><span class=p>(</span><span class=n>df</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    This function converts the GDP information from Currency
</span></span></span><span class=line><span class=cl><span class=s2>    format to float value, transforms the information of GDP from
</span></span></span><span class=line><span class=cl><span class=s2>    USD (Millions) to USD (Billions) rounding to 2 decimal places.
</span></span></span><span class=line><span class=cl><span class=s2>    The function returns the transformed dataframe.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>gdp_list</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=s2>&#34;GDP_USD_millions&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>gdp_list</span> <span class=o>=</span> <span class=p>[</span><span class=n>convert_millions_to_billions</span><span class=p>(</span><span class=n>convert_currency_to_numeric</span><span class=p>(</span><span class=n>gdp_value</span><span class=p>))</span> <span class=k>for</span> <span class=n>gdp_value</span> <span class=ow>in</span> <span class=n>gdp_list</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=p>[</span><span class=s2>&#34;GDP_USD_millions&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>gdp_list</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;GDP_USD_millions&#34;</span><span class=p>:</span> <span class=s2>&#34;GDP_USD_billions&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>df</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>load_to_csv</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=n>csv_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    This function saves the final dataframe as a `CSV` file
</span></span></span><span class=line><span class=cl><span class=s2>    in the provided path. Function returns nothing.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=o>.</span><span class=n>to_csv</span><span class=p>(</span><span class=n>csv_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>load_to_db</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=n>sql_connection</span><span class=p>,</span> <span class=n>table_name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    This function saves the final dataframe as a database table
</span></span></span><span class=line><span class=cl><span class=s2>    with the provided name. Function returns nothing.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=o>.</span><span class=n>to_sql</span><span class=p>(</span><span class=n>table_name</span><span class=p>,</span> <span class=n>sql_connection</span><span class=p>,</span> <span class=n>if_exists</span><span class=o>=</span><span class=s2>&#34;replace&#34;</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>run_query</span><span class=p>(</span><span class=n>statement</span><span class=p>,</span> <span class=n>sql_connection</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    This function runs the stated query on the database table and
</span></span></span><span class=line><span class=cl><span class=s2>    prints the output on the terminal. Function returns nothing.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Query Statement:&#34;</span><span class=p>,</span> <span class=n>statement</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>output</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_sql</span><span class=p>(</span><span class=n>statement</span><span class=p>,</span> <span class=n>sql_connection</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Query Output:&#34;</span><span class=p>,</span> <span class=n>output</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>log_progress</span><span class=p>(</span><span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    This function logs the mentioned message at a given
</span></span></span><span class=line><span class=cl><span class=s2>    stage of the code execution to a log file.
</span></span></span><span class=line><span class=cl><span class=s2>    Function returns nothing
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp_format</span> <span class=o>=</span> <span class=s2>&#34;%Y-%h-</span><span class=si>%d</span><span class=s2>-%H:%M:%S&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>now</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span> <span class=o>=</span> <span class=n>now</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=n>timestamp_format</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;./code_log.txt&#34;</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>timestamp</span> <span class=o>+</span> <span class=s2>&#34; : &#34;</span> <span class=o>+</span> <span class=n>message</span> <span class=o>+</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>log_progress</span><span class=p>(</span><span class=s2>&#34;Preliminaries complete. Initiating ETL process.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>extracted_data</span> <span class=o>=</span> <span class=n>extract</span><span class=p>(</span><span class=n>WIKIPEDIA_GDP_URL</span><span class=p>,</span> <span class=n>TABLE_ATTRIBUTES</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log_progress</span><span class=p>(</span><span class=s2>&#34;Data Extraction complete. Initiating transformation process.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>transform_data</span> <span class=o>=</span> <span class=n>transform</span><span class=p>(</span><span class=n>extracted_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log_progress</span><span class=p>(</span><span class=s2>&#34;Data Transformation complete. Initiating loading process.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>load_to_csv</span><span class=p>(</span><span class=n>transform_data</span><span class=p>,</span> <span class=s2>&#34;gdp.csv&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log_progress</span><span class=p>(</span><span class=s2>&#34;Data load to CSV file complete. Initiating SQL connection.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>sql_connection</span> <span class=o>=</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>DB_NAME</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log_progress</span><span class=p>(</span><span class=s2>&#34;SQL Connection Initiated. Initiating loading process.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>load_to_db</span><span class=p>(</span><span class=n>transform_data</span><span class=p>,</span> <span class=n>sql_connection</span><span class=p>,</span> <span class=n>TABLE_NAME</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log_progress</span><span class=p>(</span><span class=s2>&#34;Data load to database complete. Running the query&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>query_statement</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;SELECT * from </span><span class=si>{</span><span class=n>TABLE_NAME</span><span class=si>}</span><span class=s2> WHERE GDP_USD_billions &gt;= 100&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>run_query</span><span class=p>(</span><span class=n>query_statement</span><span class=p>,</span> <span class=n>sql_connection</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log_progress</span><span class=p>(</span><span class=s2>&#34;Run query complete. Closing SQL connection.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>sql_connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>log_progress</span><span class=p>(</span><span class=s1>&#39;Process Complete. Connection Closed.&#39;</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=world-top-banks---etl-process><a href=https://github.com/cham11ng/misc/tree/main/python/course/data-engineering/bank>World top Banks - ETL Process</a><a hidden class=anchor aria-hidden=true href=#world-top-banks---etl-process>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;Module: Code for ETL operations on Bank data&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sqlite3</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>bs4</span> <span class=kn>import</span> <span class=n>BeautifulSoup</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=s2>&#34;clear&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>WIKIPEDIA_BANK_URL</span> <span class=o>=</span> <span class=s2>&#34;https://web.archive.org/web/20230908091635/https://en.wikipedia.org/wiki/List_of_largest_banks&#34;</span>
</span></span><span class=line><span class=cl><span class=n>TABLE_ATTRIBUTES</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;Bank_Name&#34;</span><span class=p>,</span> <span class=s2>&#34;USD_Billion&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>DB_NAME</span> <span class=o>=</span> <span class=s2>&#34;banks.db&#34;</span>
</span></span><span class=line><span class=cl><span class=n>TABLE_NAME</span> <span class=o>=</span> <span class=s2>&#34;largest_banks&#34;</span>
</span></span><span class=line><span class=cl><span class=n>CSV_PATH</span> <span class=o>=</span> <span class=s2>&#34;banks.csv&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>extract</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>table_attributes</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    This function extracts the required
</span></span></span><span class=line><span class=cl><span class=s2>    information from the website and saves it to a dataframe. The
</span></span></span><span class=line><span class=cl><span class=s2>    function returns the dataframe for further processing.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>page_output</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>html_soup</span> <span class=o>=</span> <span class=n>BeautifulSoup</span><span class=p>(</span><span class=n>page_output</span><span class=o>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;html.parser&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>bank_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>columns</span><span class=o>=</span><span class=n>table_attributes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>tables</span> <span class=o>=</span> <span class=n>html_soup</span><span class=o>.</span><span class=n>find_all</span><span class=p>(</span><span class=s2>&#34;tbody&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>rows</span> <span class=o>=</span> <span class=n>tables</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>find_all</span><span class=p>(</span><span class=s2>&#34;tr&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>rows</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>row</span><span class=o>.</span><span class=n>find_all</span><span class=p>(</span><span class=s2>&#34;td&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>bank</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>find_all</span><span class=p>(</span><span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>billion</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>row_dict</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;Bank_Name&#34;</span><span class=p>:</span> <span class=n>bank</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;USD_Billion&#34;</span><span class=p>:</span> <span class=n>billion</span><span class=o>.</span><span class=n>text</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>row_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>row_dict</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>bank_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>([</span><span class=n>bank_df</span><span class=p>,</span> <span class=n>row_df</span><span class=p>],</span> <span class=n>ignore_index</span><span class=o>=</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>bank_df</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>convert_currency_to_numeric</span><span class=p>(</span><span class=n>currency</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    This function converts the currency text into numeric form.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>float</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>currency</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;,&#34;</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>transform</span><span class=p>(</span><span class=n>df</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    This function accesses the CSV file for exchange rate
</span></span></span><span class=line><span class=cl><span class=s2>    information, and adds three columns to the data frame, each
</span></span></span><span class=line><span class=cl><span class=s2>    containing the transformed version of Market Cap column to
</span></span></span><span class=line><span class=cl><span class=s2>    respective currencies
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>currency_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=s2>&#34;exchange_rate.csv&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>exchange_rate</span> <span class=o>=</span> <span class=n>currency_df</span><span class=o>.</span><span class=n>set_index</span><span class=p>(</span><span class=s2>&#34;Currency&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>to_dict</span><span class=p>()[</span><span class=s2>&#34;Value&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=p>[</span><span class=s2>&#34;USD_Billion&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=n>convert_currency_to_numeric</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>df</span><span class=p>[</span><span class=s2>&#34;USD_Billion&#34;</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=p>[</span><span class=s2>&#34;GBP_Billion&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>round</span><span class=p>(</span><span class=n>x</span> <span class=o>*</span> <span class=n>exchange_rate</span><span class=p>[</span><span class=s2>&#34;GBP&#34;</span><span class=p>],</span> <span class=mi>2</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>df</span><span class=p>[</span><span class=s2>&#34;USD_Billion&#34;</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=p>[</span><span class=s2>&#34;EUR_Billion&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>round</span><span class=p>(</span><span class=n>x</span> <span class=o>*</span> <span class=n>exchange_rate</span><span class=p>[</span><span class=s2>&#34;EUR&#34;</span><span class=p>],</span> <span class=mi>2</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>df</span><span class=p>[</span><span class=s2>&#34;USD_Billion&#34;</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=p>[</span><span class=s2>&#34;NPR_Billion&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>round</span><span class=p>(</span><span class=n>x</span> <span class=o>*</span> <span class=n>exchange_rate</span><span class=p>[</span><span class=s2>&#34;NPR&#34;</span><span class=p>],</span> <span class=mi>2</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>df</span><span class=p>[</span><span class=s2>&#34;USD_Billion&#34;</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>df</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>load_to_csv</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=n>csv_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    This function saves the final data frame as a `CSV` file
</span></span></span><span class=line><span class=cl><span class=s2>    in the provided path. Function returns nothing.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=o>.</span><span class=n>to_csv</span><span class=p>(</span><span class=n>csv_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>load_to_db</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=n>sql_connection</span><span class=p>,</span> <span class=n>table_name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    This function saves the final data frame as a database table
</span></span></span><span class=line><span class=cl><span class=s2>    with the provided name. Function returns nothing.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>df</span><span class=o>.</span><span class=n>to_sql</span><span class=p>(</span><span class=n>table_name</span><span class=p>,</span> <span class=n>sql_connection</span><span class=p>,</span> <span class=n>if_exists</span><span class=o>=</span><span class=s2>&#34;replace&#34;</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>run_query</span><span class=p>(</span><span class=n>statement</span><span class=p>,</span> <span class=n>sql_connection</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    This function runs the stated query on the database table and
</span></span></span><span class=line><span class=cl><span class=s2>    prints the output on the terminal. Function returns nothing.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Query Statement:&#34;</span><span class=p>,</span> <span class=n>statement</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>output</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_sql</span><span class=p>(</span><span class=n>statement</span><span class=p>,</span> <span class=n>sql_connection</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Query Output:&#34;</span><span class=p>,</span> <span class=n>output</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>log_progress</span><span class=p>(</span><span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    This function logs the mentioned message at a given
</span></span></span><span class=line><span class=cl><span class=s2>    stage of the code execution to a log file.
</span></span></span><span class=line><span class=cl><span class=s2>    Function returns nothing
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp_format</span> <span class=o>=</span> <span class=s2>&#34;%Y-%h-</span><span class=si>%d</span><span class=s2>-%H:%M:%S&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>now</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>timestamp</span> <span class=o>=</span> <span class=n>now</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=n>timestamp_format</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;./code_log.txt&#34;</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>timestamp</span> <span class=o>+</span> <span class=s2>&#34; : &#34;</span> <span class=o>+</span> <span class=n>message</span> <span class=o>+</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>log_progress</span><span class=p>(</span><span class=s2>&#34;Preliminaries complete. Initiating ETL process.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>extracted_data</span> <span class=o>=</span> <span class=n>extract</span><span class=p>(</span><span class=n>WIKIPEDIA_BANK_URL</span><span class=p>,</span> <span class=n>TABLE_ATTRIBUTES</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log_progress</span><span class=p>(</span><span class=s2>&#34;Data Extraction complete. Initiating transformation process.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>transform_data</span> <span class=o>=</span> <span class=n>transform</span><span class=p>(</span><span class=n>extracted_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log_progress</span><span class=p>(</span><span class=s2>&#34;Data Transformation complete. Initiating loading process.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>load_to_csv</span><span class=p>(</span><span class=n>transform_data</span><span class=p>,</span> <span class=s2>&#34;banks.csv&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log_progress</span><span class=p>(</span><span class=s2>&#34;Data load to CSV file complete. Initiating SQL connection.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>sql_connection</span> <span class=o>=</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=n>DB_NAME</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log_progress</span><span class=p>(</span><span class=s2>&#34;SQL Connection Initiated. Initiating loading process.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>load_to_db</span><span class=p>(</span><span class=n>transform_data</span><span class=p>,</span> <span class=n>sql_connection</span><span class=p>,</span> <span class=n>TABLE_NAME</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log_progress</span><span class=p>(</span><span class=s2>&#34;Data load to database complete. Running the query&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>query_statement</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;SELECT * FROM </span><span class=si>{</span><span class=n>TABLE_NAME</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>run_query</span><span class=p>(</span><span class=n>query_statement</span><span class=p>,</span> <span class=n>sql_connection</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log_progress</span><span class=p>(</span><span class=s2>&#34;Run query 1 complete. Closing SQL connection.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>query_statement</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;SELECT AVG(NPR_Billion) FROM </span><span class=si>{</span><span class=n>TABLE_NAME</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>run_query</span><span class=p>(</span><span class=n>query_statement</span><span class=p>,</span> <span class=n>sql_connection</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log_progress</span><span class=p>(</span><span class=s2>&#34;Run query 2 complete. Closing SQL connection.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>query_statement</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;SELECT * FROM </span><span class=si>{</span><span class=n>TABLE_NAME</span><span class=si>}</span><span class=s2> LIMIT 5&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>run_query</span><span class=p>(</span><span class=n>query_statement</span><span class=p>,</span> <span class=n>sql_connection</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>log_progress</span><span class=p>(</span><span class=s2>&#34;Run query 3 complete. Closing SQL connection.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>sql_connection</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>log_progress</span><span class=p>(</span><span class=s2>&#34;Process Complete. Connection Closed.&#34;</span><span class=p>)</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy;
2025
<a href=http://localhost:1313/>Agus Fahmi Aji Pramana's Blogging Site</a></span>
| <span><a href=/terms-and-conditions>Terms and Conditions</a>
</span>|
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a>
&
      <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span><br></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})}),document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".project");e.forEach(function(e){e.addEventListener("click",function(t){t.target.closest(".small-icons")||window.open(e.getAttribute("data-project-link"),"_blank").focus()})})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>