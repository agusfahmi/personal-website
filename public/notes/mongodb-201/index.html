<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>MongoDB 201 |
Agus Fahmi Aji Pramana's Blogging Site
</title><meta name=keywords content><meta name=description content="
    MongoDB 201"><meta name=author content="Agus Fahmi Aji Pramana"><link rel=canonical href=http://localhost:1313/notes/mongodb-201/><link crossorigin=anonymous href=/assets/css/stylesheet.606be4c20b063263aae99830f89a0f4bbedcc98a7b8fea0b216f60439a69a571.css integrity="sha256-YGvkwgsGMmOq6Zgw+JoPS77cyYp7j+oLIW9gQ5pppXE=" rel="preload stylesheet" as=style><link crossorigin=anonymous referrerpolicy=no-referrer rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="><link rel=icon href=http://localhost:1313/favicon.ico type=image/x-icon><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=manifest href=/site.webmanifest><link rel=icon type=image/png sizes=192x192 href=http://localhost:1313/img/android-chrome-192x192.png><link rel=icon type=image/png sizes=512x512 href=http://localhost:1313/img/android-chrome-512x512.png><link rel=apple-touch-icon href=http://localhost:1313/img/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/safari-pinned-tab.svg color=#2e2e33><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33
  "><link rel=alternate hreflang=en href=http://localhost:1313/notes/mongodb-201/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="MongoDB 201"><meta property="og:description" content="MongoDB 201"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/notes/mongodb-201/"><meta property="og:image" content="http://localhost:1313/logo.svg"><meta property="article:section" content="notes"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/logo.svg"><meta name=twitter:title content="MongoDB 201"><meta name=twitter:description content="MongoDB 201"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Personal Notes, Learning, Self-Preparation","item":"http://localhost:1313/notes/"},{"@type":"ListItem","position":2,"name":"MongoDB 201","item":"http://localhost:1313/notes/mongodb-201/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"MongoDB 201","name":"MongoDB 201","description":"MongoDB 201","keywords":[],"articleBody":"collection help keep documents organized. cap collections to store a maximum amount of documents at any one time\n# Basics $ db.getName(); $ db.recipes.insertOne({}); $ db.recipes.find({\"title\": { $regex: /taco/i }}, {title: 1, _id: 0}); # show # $ show collections; # sub-collection -\u003e using dot $ db.cool.mid.insertOne({}) # same but can be helpful for query purpose sort, skip, limit # searching $ db.recipes.find().count() $ db.recipes.find({}, {title: 1}).limit(3) # sorting $ db.recipes.find({}, {title: 1}).sort({title: -1}) # asc $ db.recipes.find({}, {title: 1}).sort({title: -1}) # desc # skip $ db.recipes.find({}, {title: 1}).skip(2).limit(1) operators $gt -\u003e \u003e $lt -\u003e \u003c $lte -\u003e \u003c= $ db.recipes.find({cook_time: {$lte:30 }, prep_time:{$lte: 10}}, {title: 1}) # and $ db.recipes.find({ tags: { $all: [\"easy\", \"quick\"]}}, {title: 1, tags: 1}) # or $ db.recipes.find({ tags: { $in: [\"easy\", \"quick\"]}}, {title: 1, tags: 1}) # nested $ db.recipes.find({ \"ingredients.name\": \"egg\" }, { title: 1}) updating $set $unset $inc $ db.examples.updateOne({title: \"Pizza\"}, {$set: {title: \"Crust pizza\"}}) # upsert -\u003e update or insert depending upon already exists or not. $ db.examples.updateOne({title: \"Crust pizza\"}, {$set: {vegan: false}}) # remove key $ db.examples.updateOne({title: \"Crust pizza\"}, {$unset: {vegan: 1}}) # increment $ db.examples.updateOne({title: \"Tacos\"}, {$inc: {\"likes_count\": 1}}) # check $ db.examples.find({title: \"Tacos\"}).pretty() eventual consistency (atomic operation =\u003e multiple user setting value) no locks or transactions.\nupdate arrays $push -\u003e into array end $pull \u003c- take out $ db.examples.updateOne({\"title\": \"Tacos\"}, { $push: {\"likes\": 60}}) $ db.examples.updateOne({\"title\": \"Tacos\"}, { $pull: {\"likes\": 60}}) delete documents # delete $ db.examples.deleteOne({ title: \"Delete me\" }) challenge queries # top rated recipes $ db.recipes.find({}, {title: 1}).sort({ 'rating_avg': -1 }).limit(4) # top mexican recipes $ db.recipes.find({ tags: \"mexican\" }, {title: 1}) .sort({ 'rating_avg': -1 }) .limit(4) # recipes liked by other $ db.recipes.find({}, {title: 1, likes: 1}).sort({ title: 1 }) # recipes liked by user 1 and 35 $ db.recipes.find({likes: {$in: [1, 35]}}, {title: 1}).sort({title: 1}) schema modeling embed other document using a sub-document if the data is always going to read and modify it. simplify and reduce queries. references data rarely read at the same time. do we need this data on load? consider unique indexing in both documents. e.g. create comments in separate document, create another top-comments in separate document. gotchas: will your data change? or user ever want to see all comments they’ve ever made so no need to store with users. indexing indexes help queries zoom easily look up a matching document without scanning every document in your collection # checking query execution plan for 7 documents. $ db.recipes.find({cook_time: 10}, {title: 1}).explain('executionStats') { ... executionStats: { ... totalDocsExamined: 7, } } # creating cook_time index in descending order. $ db.recipes.createIndex({\"cook_time\": -1}); # fetching indexes. $ db.recipes.getIndexes() [ { v: 2, key: { _id: 1 }, name: '_id_' }, { v: 2, key: { cook_time: -1 }, name: 'cook_time_-1' } ] # checking query execution plan after indexing. $ db.recipes.find({cook_time: 10}, {title: 1}).explain('executionStats') { ... executionStats: { ... totalDocsExamined: 1, } } # dropping indexes $ db.recipes.dropIndex(\"cook_time_-1\") GridFS break files into chunks. chunks stored in separate documents. a parent document keeps track of file data. the chunks are streamed back via a MongoDB client. e.g. kind of sensor data, maybe a really smart smoker pellet grill. capped collections cap the amount of data or documents guaranteed insertion order limited by disk size or document count. automatic deletion first in, first out based off guaranteed order. always deletes when max size is reached no need to worry e.g. log data, saving images. $ db.createCollection(\"error_log\", { capped: true, size: 10000, max: 10000}) # convert existing collection. db.runComment({ \"convertToCapped\": \"error_log2\", size: 10000 }) limitations no index by default (note if needed to update documents often). can’t shard a capped collection. time series collections new in MongoDB 5.0 data that changes over time, but also has a key that doesn’t change, focus on unchanging parameters. keeps metadata ata points in time. store data at a given time and keep measuring and tracking that. e.g. stock data -\u003e stock symbol doesn’t change and metadata track every 30 seconds. building out chart to do analysis, data is already optimized for those queries later. server administration MongoDB config file mongod --config=advanced.cfg # mongod.conf systemLog: destination: file path: /usr/local/var/log/mongodb/mongo.log logAppend: true storage: dbPath: /usr/local/var/mongodb net: bindIp: 127.0.0.1 port: 27017 # advanced.cfg systemLog: destination: file path: /var/log/mongodb/mongo.log logAppend: true storage: dbPath: /store/db directoryPerDB: true net: bindIp: 127.0.0.1 port: 27017 maxIncomingConnections: 65536 processManagement: fork: true # default false security: authorization: enabled # role-based javascriptEnabled: true replication: replSetName: cookerSet replication $ mongod --replSet cookingSet --dbpath=/store/data/rs1 --port 27017 \\ --smallfiles --oplogSize 200 $ mongod --replSet cookingSet --dbpath=/store/data/rs2 --port 27018 \\ --smallfiles --oplogSize 200 $ mongo --port 28018 \u003e config = { _id: 'cookingSet', members: [ {_id: 0, host: 'localhost:27017'}, {_id: 1: host: 'localhost:27018'} ] } \u003e rs.initiate(config) cookingSet:PRIMARY\u003e rs.status() # connection string $ mongo \"mongodb://localhost:27017,localhost:27018/?replicaSet=cookingSet\" sharding takes data and breaks it up/partitioning data amongst multiple servers. with MongoDB, data auto shard is possible. not that hard, but it is more complicated don’t do it if you don’t need to. scale-out as your data grows using sharding. authentication and authorization logging in and limiting access # change user \u003e use admin; # create user \u003e db.createUser( { user: \"foo\", pwd: passwordPrompt(), roles: [ { role: \"userAdminAnyDatabase\", db: \"admin\" }, \"readWriteAnyDatabase\" ] } ); \u003e db.adminCommand({ shutdown: 1 }); \u003e mongo --authenticationDatabase \"admin\" -u \"foo\" -p or \u003e use admin; \u003e db.auth(\"foo\", passwordPrompt()); Enter password: 1 # Successful logged in. backup # lock against writes. \u003e db.fsyncLock(); cp -R /data/db/* ../path/to/backup \u003e db.fsyncUnlock(); # downside =\u003e expected downtime. \u003e mongodump \u003e mongorestore resources https://github.com/LinkedInLearning/introduction-to-mongodb-4315215/tree/main/collections ","wordCount":"920","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"Agus Fahmi Aji Pramana"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/notes/mongodb-201/"},"publisher":{"@type":"Organization","name":"Agus Fahmi Aji Pramana's Blogging Site","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Agus Fahmi Aji Pramana (Alt + H)">Agus Fahmi Aji Pramana</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=http://localhost:1313/about-me title="About Me"><span>About Me</span></a></li><li><a href=http://localhost:1313/blogs title=Blogs><span>Blogs</span></a></li><li><a href=http://localhost:1313/projects title=Projects><span>Projects</span></a></li><li><a href=http://localhost:1313/slides title=Slides><span>Slides</span></a></li><li><a href=http://localhost:1313/honors title=Honors><span>Honors</span></a></li><li><a href=http://localhost:1313/search title="Search (Alt + /)" accesskey=/><i class="fa fa-search"></i></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/notes/>Personal Notes, Learning, Self-Preparation</a></div><h1 class="post-title entry-hint-parent">MongoDB 201</h1><div class=post-description>MongoDB 201</div><div class=post-meta>5 min&nbsp;·&nbsp;920 words&nbsp;·&nbsp;Agus Fahmi Aji Pramana</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Agenda</span></summary><div class=inner><ul><li><a href=#collection aria-label=collection>collection</a></li><li><a href=#sort-skip-limit aria-label="sort, skip, limit">sort, skip, limit</a></li><li><a href=#operators aria-label=operators>operators</a></li><li><a href=#updating aria-label=updating>updating</a><ul><li><a href=#update-arrays aria-label="update arrays">update arrays</a></li></ul></li><li><a href=#delete-documents aria-label="delete documents">delete documents</a></li><li><a href=#challenge-queries aria-label="challenge queries">challenge queries</a></li><li><a href=#schema-modeling aria-label="schema modeling">schema modeling</a><ul><li><a href=#references aria-label=references>references</a></li></ul></li><li><a href=#indexing aria-label=indexing>indexing</a></li><li><a href=#gridfs aria-label=GridFS>GridFS</a><ul><li><a href=#capped-collections aria-label="capped collections">capped collections</a><ul><li><a href=#limitations aria-label=limitations>limitations</a></li></ul></li><li><a href=#time-series-collections aria-label="time series collections">time series collections</a></li></ul></li><li><a href=#server-administration aria-label="server administration">server administration</a><ul><li><a href=#mongodb-config-file aria-label="MongoDB config file">MongoDB config file</a></li><li><a href=#replication aria-label=replication>replication</a></li><li><a href=#sharding aria-label=sharding>sharding</a></li><li><a href=#authentication-and-authorization aria-label="authentication and authorization">authentication and authorization</a></li><li><a href=#backup aria-label=backup>backup</a></li></ul></li><li><a href=#resources aria-label=resources>resources</a></li></ul></div></details></div><div class=post-content><h2 id=collection>collection<a hidden class=anchor aria-hidden=true href=#collection>#</a></h2><ul><li>help keep documents organized.</li></ul><blockquote><p>cap collections to store a maximum amount of documents at any one time</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Basics</span>
</span></span><span class=line><span class=cl>$ db.getName<span class=o>()</span><span class=p>;</span>
</span></span><span class=line><span class=cl>$ db.recipes.insertOne<span class=o>({})</span><span class=p>;</span>
</span></span><span class=line><span class=cl>$ db.recipes.find<span class=o>({</span><span class=s2>&#34;title&#34;</span>: <span class=o>{</span> <span class=nv>$regex</span>: /taco/i <span class=o>}}</span>, <span class=o>{</span>title: 1, _id: 0<span class=o>})</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># show</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>$ show collections<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># sub-collection -&gt; using dot</span>
</span></span><span class=line><span class=cl>$ db.cool.mid.insertOne<span class=o>({})</span> <span class=c1># same but can be helpful for query purpose</span>
</span></span></code></pre></div><h2 id=sort-skip-limit>sort, skip, limit<a hidden class=anchor aria-hidden=true href=#sort-skip-limit>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># searching</span>
</span></span><span class=line><span class=cl>$ db.recipes.find<span class=o>()</span>.count<span class=o>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ db.recipes.find<span class=o>({}</span>, <span class=o>{</span>title: 1<span class=o>})</span>.limit<span class=o>(</span>3<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># sorting</span>
</span></span><span class=line><span class=cl>$ db.recipes.find<span class=o>({}</span>, <span class=o>{</span>title: 1<span class=o>})</span>.sort<span class=o>({</span>title: -1<span class=o>})</span> <span class=c1># asc</span>
</span></span><span class=line><span class=cl>$ db.recipes.find<span class=o>({}</span>, <span class=o>{</span>title: 1<span class=o>})</span>.sort<span class=o>({</span>title: -1<span class=o>})</span> <span class=c1># desc</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># skip</span>
</span></span><span class=line><span class=cl>$ db.recipes.find<span class=o>({}</span>, <span class=o>{</span>title: 1<span class=o>})</span>.skip<span class=o>(</span>2<span class=o>)</span>.limit<span class=o>(</span>1<span class=o>)</span>
</span></span></code></pre></div><h2 id=operators>operators<a hidden class=anchor aria-hidden=true href=#operators>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$gt</span>   -&gt; &gt;
</span></span><span class=line><span class=cl><span class=nv>$lt</span>   -&gt; &lt;
</span></span><span class=line><span class=cl><span class=nv>$lte</span>  -&gt; &lt;<span class=o>=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ db.recipes.find<span class=o>({</span>cook_time: <span class=o>{</span><span class=nv>$lte</span>:30 <span class=o>}</span>, prep_time:<span class=o>{</span><span class=nv>$lte</span>: 10<span class=o>}}</span>, <span class=o>{</span>title: 1<span class=o>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># and</span>
</span></span><span class=line><span class=cl>$ db.recipes.find<span class=o>({</span> tags: <span class=o>{</span> <span class=nv>$all</span>: <span class=o>[</span><span class=s2>&#34;easy&#34;</span>, <span class=s2>&#34;quick&#34;</span><span class=o>]}}</span>, <span class=o>{</span>title: 1, tags: 1<span class=o>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl>$ db.recipes.find<span class=o>({</span> tags: <span class=o>{</span> <span class=nv>$in</span>: <span class=o>[</span><span class=s2>&#34;easy&#34;</span>, <span class=s2>&#34;quick&#34;</span><span class=o>]}}</span>, <span class=o>{</span>title: 1, tags: 1<span class=o>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># nested</span>
</span></span><span class=line><span class=cl>$ db.recipes.find<span class=o>({</span> <span class=s2>&#34;ingredients.name&#34;</span>: <span class=s2>&#34;egg&#34;</span> <span class=o>}</span>, <span class=o>{</span> title: 1<span class=o>})</span>
</span></span></code></pre></div><h2 id=updating>updating<a hidden class=anchor aria-hidden=true href=#updating>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$set</span>
</span></span><span class=line><span class=cl><span class=nv>$unset</span>
</span></span><span class=line><span class=cl><span class=nv>$inc</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ db.examples.updateOne<span class=o>({</span>title: <span class=s2>&#34;Pizza&#34;</span><span class=o>}</span>, <span class=o>{</span><span class=nv>$set</span>: <span class=o>{</span>title: <span class=s2>&#34;Crust pizza&#34;</span><span class=o>}})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># upsert -&gt; update or insert depending upon already exists or not.</span>
</span></span><span class=line><span class=cl>$ db.examples.updateOne<span class=o>({</span>title: <span class=s2>&#34;Crust pizza&#34;</span><span class=o>}</span>, <span class=o>{</span><span class=nv>$set</span>: <span class=o>{</span>vegan: false<span class=o>}})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># remove key</span>
</span></span><span class=line><span class=cl>$ db.examples.updateOne<span class=o>({</span>title: <span class=s2>&#34;Crust pizza&#34;</span><span class=o>}</span>, <span class=o>{</span><span class=nv>$unset</span>: <span class=o>{</span>vegan: 1<span class=o>}})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># increment</span>
</span></span><span class=line><span class=cl>$ db.examples.updateOne<span class=o>({</span>title: <span class=s2>&#34;Tacos&#34;</span><span class=o>}</span>, <span class=o>{</span><span class=nv>$inc</span>: <span class=o>{</span><span class=s2>&#34;likes_count&#34;</span>: 1<span class=o>}})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># check</span>
</span></span><span class=line><span class=cl>$ db.examples.find<span class=o>({</span>title: <span class=s2>&#34;Tacos&#34;</span><span class=o>})</span>.pretty<span class=o>()</span>
</span></span></code></pre></div><blockquote><p>eventual consistency (atomic operation => multiple user setting value)
no locks or transactions.</p></blockquote><h3 id=update-arrays>update arrays<a hidden class=anchor aria-hidden=true href=#update-arrays>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$push</span> -&gt; into array end
</span></span><span class=line><span class=cl><span class=nv>$pull</span> &lt;- take out
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ db.examples.updateOne<span class=o>({</span><span class=s2>&#34;title&#34;</span>: <span class=s2>&#34;Tacos&#34;</span><span class=o>}</span>, <span class=o>{</span> <span class=nv>$push</span>: <span class=o>{</span><span class=s2>&#34;likes&#34;</span>: 60<span class=o>}})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ db.examples.updateOne<span class=o>({</span><span class=s2>&#34;title&#34;</span>: <span class=s2>&#34;Tacos&#34;</span><span class=o>}</span>, <span class=o>{</span> <span class=nv>$pull</span>: <span class=o>{</span><span class=s2>&#34;likes&#34;</span>: 60<span class=o>}})</span>
</span></span></code></pre></div><h2 id=delete-documents>delete documents<a hidden class=anchor aria-hidden=true href=#delete-documents>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># delete</span>
</span></span><span class=line><span class=cl>$ db.examples.deleteOne<span class=o>({</span> title: <span class=s2>&#34;Delete me&#34;</span> <span class=o>})</span>
</span></span></code></pre></div><h2 id=challenge-queries>challenge queries<a hidden class=anchor aria-hidden=true href=#challenge-queries>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># top rated recipes</span>
</span></span><span class=line><span class=cl>$ db.recipes.find<span class=o>({}</span>, <span class=o>{</span>title: 1<span class=o>})</span>.sort<span class=o>({</span> <span class=s1>&#39;rating_avg&#39;</span>: -1 <span class=o>})</span>.limit<span class=o>(</span>4<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># top mexican recipes</span>
</span></span><span class=line><span class=cl>$ db.recipes.find<span class=o>({</span> tags: <span class=s2>&#34;mexican&#34;</span> <span class=o>}</span>, <span class=o>{</span>title: 1<span class=o>})</span>
</span></span><span class=line><span class=cl>  .sort<span class=o>({</span> <span class=s1>&#39;rating_avg&#39;</span>: -1 <span class=o>})</span>
</span></span><span class=line><span class=cl>  .limit<span class=o>(</span>4<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># recipes liked by other</span>
</span></span><span class=line><span class=cl>$ db.recipes.find<span class=o>({}</span>, <span class=o>{</span>title: 1, likes: 1<span class=o>})</span>.sort<span class=o>({</span> title: <span class=m>1</span> <span class=o>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># recipes liked by user 1 and 35</span>
</span></span><span class=line><span class=cl>$ db.recipes.find<span class=o>({</span>likes: <span class=o>{</span><span class=nv>$in</span>: <span class=o>[</span>1, 35<span class=o>]}}</span>, <span class=o>{</span>title: 1<span class=o>})</span>.sort<span class=o>({</span>title: 1<span class=o>})</span>
</span></span></code></pre></div><h2 id=schema-modeling>schema modeling<a hidden class=anchor aria-hidden=true href=#schema-modeling>#</a></h2><ul><li>embed other document using a sub-document if the data is always going to read and modify it.</li><li>simplify and reduce queries.</li></ul><h3 id=references>references<a hidden class=anchor aria-hidden=true href=#references>#</a></h3><ul><li>data rarely read at the same time.</li><li>do we need this data on load?</li><li>consider unique indexing in both documents.</li><li>e.g. create comments in separate document, create another top-comments in separate document.</li><li><strong>gotchas</strong>: will your data change? or user ever want to see all comments they&rsquo;ve ever made so no need to store with users.</li></ul><h2 id=indexing>indexing<a hidden class=anchor aria-hidden=true href=#indexing>#</a></h2><ul><li>indexes help queries zoom</li><li>easily look up a matching document</li><li>without scanning every document in your collection</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># checking query execution plan for 7 documents.</span>
</span></span><span class=line><span class=cl>$ db.recipes.find<span class=o>({</span>cook_time: 10<span class=o>}</span>, <span class=o>{</span>title: 1<span class=o>})</span>.explain<span class=o>(</span><span class=s1>&#39;executionStats&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  ...
</span></span><span class=line><span class=cl>   executionStats: <span class=o>{</span>
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl>    totalDocsExamined: 7,
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># creating cook_time index in descending order.</span>
</span></span><span class=line><span class=cl>$ db.recipes.createIndex<span class=o>({</span><span class=s2>&#34;cook_time&#34;</span>: -1<span class=o>})</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># fetching indexes.</span>
</span></span><span class=line><span class=cl>$ db.recipes.getIndexes<span class=o>()</span>
</span></span><span class=line><span class=cl><span class=o>[</span>
</span></span><span class=line><span class=cl>  <span class=o>{</span> v: 2, key: <span class=o>{</span> _id: <span class=m>1</span> <span class=o>}</span>, name: <span class=s1>&#39;_id_&#39;</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>  <span class=o>{</span> v: 2, key: <span class=o>{</span> cook_time: -1 <span class=o>}</span>, name: <span class=s1>&#39;cook_time_-1&#39;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># checking query execution plan after indexing.</span>
</span></span><span class=line><span class=cl>$ db.recipes.find<span class=o>({</span>cook_time: 10<span class=o>}</span>, <span class=o>{</span>title: 1<span class=o>})</span>.explain<span class=o>(</span><span class=s1>&#39;executionStats&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  ...
</span></span><span class=line><span class=cl>   executionStats: <span class=o>{</span>
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl>    totalDocsExamined: 1,
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># dropping indexes</span>
</span></span><span class=line><span class=cl>$ db.recipes.dropIndex<span class=o>(</span><span class=s2>&#34;cook_time_-1&#34;</span><span class=o>)</span>
</span></span></code></pre></div><h2 id=gridfs>GridFS<a hidden class=anchor aria-hidden=true href=#gridfs>#</a></h2><ul><li>break files into chunks.</li><li>chunks stored in separate documents.</li><li>a parent document keeps track of file data.</li><li>the chunks are streamed back via a MongoDB client.</li><li>e.g. kind of sensor data, maybe a really smart smoker pellet grill.</li></ul><h3 id=capped-collections>capped collections<a hidden class=anchor aria-hidden=true href=#capped-collections>#</a></h3><ul><li>cap the amount of data or documents</li><li>guaranteed insertion order</li><li>limited<ul><li>by disk size or document count.</li></ul></li><li>automatic deletion<ul><li>first in, first out</li><li>based off guaranteed order.</li><li>always deletes when max size is reached</li><li>no need to worry</li></ul></li><li>e.g. log data, saving images.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ db.createCollection<span class=o>(</span><span class=s2>&#34;error_log&#34;</span>, <span class=o>{</span> capped: true, size: 10000, max: 10000<span class=o>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># convert existing collection.</span>
</span></span><span class=line><span class=cl>db.runComment<span class=o>({</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;convertToCapped&#34;</span>: <span class=s2>&#34;error_log2&#34;</span>,
</span></span><span class=line><span class=cl>  size: <span class=m>10000</span>
</span></span><span class=line><span class=cl><span class=o>})</span>
</span></span></code></pre></div><h4 id=limitations>limitations<a hidden class=anchor aria-hidden=true href=#limitations>#</a></h4><ul><li>no index by default (note if needed to update documents often).</li><li>can&rsquo;t shard a capped collection.</li></ul><h3 id=time-series-collections>time series collections<a hidden class=anchor aria-hidden=true href=#time-series-collections>#</a></h3><ul><li>new in MongoDB 5.0</li><li>data that changes over time, but also has a key that doesn&rsquo;t change, focus on unchanging parameters.</li><li>keeps metadata ata points in time.</li><li>store data at a given time and keep measuring and tracking that.</li><li>e.g. stock data -> stock symbol doesn&rsquo;t change and metadata track every 30 seconds.</li><li>building out chart to do analysis, data is already optimized for those queries later.</li></ul><h2 id=server-administration>server administration<a hidden class=anchor aria-hidden=true href=#server-administration>#</a></h2><h3 id=mongodb-config-file>MongoDB config file<a hidden class=anchor aria-hidden=true href=#mongodb-config-file>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mongod --config<span class=o>=</span>advanced.cfg
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># mongod.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>systemLog</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>destination</span><span class=p>:</span><span class=w> </span><span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/usr/local/var/log/mongodb/mongo.log</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logAppend</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>storage</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dbPath</span><span class=p>:</span><span class=w> </span><span class=l>/usr/local/var/mongodb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>net</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>bindIp</span><span class=p>:</span><span class=w> </span><span class=m>127.0.0.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>27017</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># advanced.cfg</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>systemLog</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>destination</span><span class=p>:</span><span class=w> </span><span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/var/log/mongodb/mongo.log</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logAppend</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>storage</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dbPath</span><span class=p>:</span><span class=w> </span><span class=l>/store/db</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>directoryPerDB</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>net</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>bindIp</span><span class=p>:</span><span class=w> </span><span class=m>127.0.0.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>27017</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>maxIncomingConnections</span><span class=p>:</span><span class=w> </span><span class=m>65536</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processManagement</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>fork</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w> </span><span class=c># default false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>security</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>authorization</span><span class=p>:</span><span class=w> </span><span class=l>enabled</span><span class=w> </span><span class=c># role-based</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>javascriptEnabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>replication</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replSetName</span><span class=p>:</span><span class=w> </span><span class=l>cookerSet</span><span class=w>
</span></span></span></code></pre></div><h3 id=replication>replication<a hidden class=anchor aria-hidden=true href=#replication>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ mongod --replSet cookingSet --dbpath<span class=o>=</span>/store/data/rs1 --port <span class=m>27017</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --smallfiles --oplogSize <span class=m>200</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ mongod --replSet cookingSet --dbpath<span class=o>=</span>/store/data/rs2 --port <span class=m>27018</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --smallfiles --oplogSize <span class=m>200</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ mongo --port <span class=m>28018</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; <span class=nv>config</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  _id: <span class=s1>&#39;cookingSet&#39;</span>,
</span></span><span class=line><span class=cl>  members: <span class=o>[</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>_id: 0, host: <span class=s1>&#39;localhost:27017&#39;</span><span class=o>}</span>,
</span></span><span class=line><span class=cl>    <span class=o>{</span>_id: 1: host: <span class=s1>&#39;localhost:27018&#39;</span><span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; rs.initiate<span class=o>(</span>config<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cookingSet:PRIMARY&gt; rs.status<span class=o>()</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># connection string</span>
</span></span><span class=line><span class=cl>$ mongo <span class=s2>&#34;mongodb://localhost:27017,localhost:27018/?replicaSet=cookingSet&#34;</span>
</span></span></code></pre></div><h3 id=sharding>sharding<a hidden class=anchor aria-hidden=true href=#sharding>#</a></h3><ul><li>takes data and breaks it up/partitioning data amongst multiple servers.</li><li>with MongoDB, data auto shard is possible.</li><li>not that hard, but it is more complicated</li><li>don&rsquo;t do it if you don&rsquo;t need to.</li><li>scale-out as your data grows using sharding.</li></ul><p><input type=checkbox id=zoomCheck-717e3 hidden>
<label for=zoomCheck-717e3><img class=zoomCheck loading=lazy decoding=async src=img/basic-sharding.webp alt="Basic Sharding"></label></p><h3 id=authentication-and-authorization>authentication and authorization<a hidden class=anchor aria-hidden=true href=#authentication-and-authorization>#</a></h3><ul><li>logging in and limiting access</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># change user</span>
</span></span><span class=line><span class=cl>&gt; use admin<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># create user</span>
</span></span><span class=line><span class=cl>&gt; db.createUser<span class=o>(</span>
</span></span><span class=line><span class=cl>  <span class=o>{</span>
</span></span><span class=line><span class=cl>    user: <span class=s2>&#34;foo&#34;</span>,
</span></span><span class=line><span class=cl>    pwd: passwordPrompt<span class=o>()</span>,
</span></span><span class=line><span class=cl>    roles: <span class=o>[</span>
</span></span><span class=line><span class=cl>      <span class=o>{</span>
</span></span><span class=line><span class=cl>        role: <span class=s2>&#34;userAdminAnyDatabase&#34;</span>,
</span></span><span class=line><span class=cl>        db: <span class=s2>&#34;admin&#34;</span>
</span></span><span class=line><span class=cl>      <span class=o>}</span>,
</span></span><span class=line><span class=cl>      <span class=s2>&#34;readWriteAnyDatabase&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>]</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; db.adminCommand<span class=o>({</span> shutdown: <span class=m>1</span> <span class=o>})</span><span class=p>;</span>
</span></span><span class=line><span class=cl>&gt; mongo --authenticationDatabase <span class=s2>&#34;admin&#34;</span> -u <span class=s2>&#34;foo&#34;</span> -p
</span></span><span class=line><span class=cl>or
</span></span><span class=line><span class=cl>&gt; use admin<span class=p>;</span>
</span></span><span class=line><span class=cl>&gt; db.auth<span class=o>(</span><span class=s2>&#34;foo&#34;</span>, passwordPrompt<span class=o>())</span><span class=p>;</span>
</span></span><span class=line><span class=cl>Enter password:
</span></span><span class=line><span class=cl><span class=m>1</span> <span class=c1># Successful logged in.</span>
</span></span></code></pre></div><h3 id=backup>backup<a hidden class=anchor aria-hidden=true href=#backup>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># lock against writes.</span>
</span></span><span class=line><span class=cl>&gt; db.fsyncLock<span class=o>()</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cp -R /data/db/* ../path/to/backup
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; db.fsyncUnlock<span class=o>()</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># downside =&gt; expected downtime.</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; mongodump
</span></span><span class=line><span class=cl>&gt; mongorestore
</span></span></code></pre></div><h2 id=resources>resources<a hidden class=anchor aria-hidden=true href=#resources>#</a></h2><ul><li></li><li><a href=https://github.com/LinkedInLearning/introduction-to-mongodb-4315215/tree/main/collections>https://github.com/LinkedInLearning/introduction-to-mongodb-4315215/tree/main/collections</a></li></ul></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy;
2025
<a href=http://localhost:1313/>Agus Fahmi Aji Pramana's Blogging Site</a></span>
| <span><a href=/terms-and-conditions>Terms and Conditions</a>
</span>|
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a>
&
      <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span><br></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})}),document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".project");e.forEach(function(e){e.addEventListener("click",function(t){t.target.closest(".small-icons")||window.open(e.getAttribute("data-project-link"),"_blank").focus()})})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>