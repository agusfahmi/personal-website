<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>SQL Index Monitoring and Rebuilding |
Agus Fahmi Aji Pramana's Blogging Site
</title><meta name=keywords content="sql,indexing"><meta name=description content="
    Monitoring and Rebuilding Indexes in SQL"><meta name=author content="Agus Fahmi Aji Pramana"><link rel=canonical href=http://localhost:1313/blogs/tech/sql-index-monitoring-and-rebuilding/><link crossorigin=anonymous href=/assets/css/stylesheet.606be4c20b063263aae99830f89a0f4bbedcc98a7b8fea0b216f60439a69a571.css integrity="sha256-YGvkwgsGMmOq6Zgw+JoPS77cyYp7j+oLIW9gQ5pppXE=" rel="preload stylesheet" as=style><link crossorigin=anonymous referrerpolicy=no-referrer rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="><link rel=icon href=http://localhost:1313/favicon.ico type=image/x-icon><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=manifest href=/site.webmanifest><link rel=icon type=image/png sizes=192x192 href=http://localhost:1313/img/android-chrome-192x192.png><link rel=icon type=image/png sizes=512x512 href=http://localhost:1313/img/android-chrome-512x512.png><link rel=apple-touch-icon href=http://localhost:1313/img/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/safari-pinned-tab.svg color=#2e2e33><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33
  "><link rel=alternate hreflang=en href=http://localhost:1313/blogs/tech/sql-index-monitoring-and-rebuilding/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-PJ6VCR89GD"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PJ6VCR89GD")}</script><meta property="og:title" content="SQL Index Monitoring and Rebuilding"><meta property="og:description" content="Monitoring and Rebuilding Indexes in SQL"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/blogs/tech/sql-index-monitoring-and-rebuilding/"><meta property="og:image" content="http://localhost:1313/logo.svg"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2021-04-19T00:00:00+00:00"><meta property="article:modified_time" content="2021-04-19T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/logo.svg"><meta name=twitter:title content="SQL Index Monitoring and Rebuilding"><meta name=twitter:description content="Monitoring and Rebuilding Indexes in SQL"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"http://localhost:1313/blogs/"},{"@type":"ListItem","position":2,"name":"#tech","item":"http://localhost:1313/blogs/tech/"},{"@type":"ListItem","position":3,"name":"SQL Index Monitoring and Rebuilding","item":"http://localhost:1313/blogs/tech/sql-index-monitoring-and-rebuilding/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"SQL Index Monitoring and Rebuilding","name":"SQL Index Monitoring and Rebuilding","description":"Monitoring and Rebuilding Indexes in SQL","keywords":["sql","indexing"],"articleBody":"Index Fragmentation Index Fragmentation percentage varies when the logical page orders don’t coordinate with the physical page order in the page allocation of an index. With the data modification in the table, information can be resized on the data page. Users can observe the disturbing page order with the massive delete operation on the table. Along with the update and delete operations, the data page won’t be a top-full or empty page. Therefore, non-utilized free space raises the order mismatch between logical page and physical page with increasing the fragmentation, and that can cause worst query performance and consumes more server resources as well. There can be a number of indexes created on a single table with the combination of various columns, and each index can have a different fragmentation percentage. Fragmentation Status using the inbuilt T-SQL statement SELECT S.name AS 'Schema', T.name AS 'Table', I.name AS 'Index', DDIPS.avg_fragmentation_in_percent, DDIPS.page_count FROM sys.dm_db_index_physical_stats(DB_ID(), NULL, NULL, NULL, NULL) AS DDIPS INNER JOIN sys.tables T ON T.object_id = DDIPS.object_id INNER JOIN sys.schemas S ON T.schema_id = S.schema_id INNER JOIN sys.indexes I ON I.object_id = DDIPS.object_id AND DDIPS.index_id = I.index_id WHERE DDIPS.database_id = DB_ID() AND I.name IS NOT NULL AND DDIPS.avg_fragmentation_in_percent \u003e 0 ORDER BY DDIPS.avg_fragmentation_in_percent DESC Output Here, we can see the maximum fragmentation percentage is 94% in the local database right after loading dummy data. To reduce this fragmentation, either of these can be performed in the database:\nREBUILD INDEX The INDEX REBUILD always drops the index and reproduces it with new index pages which runs with the ALTER INDEX command. This activity can be run in parallel using an online option which does not affect the running requests and tasks of a similar table. In the case of REBUILD INDEX offline, then the object resource of the index won’t be accessible till the end of the REBUILD process completion.\n--Basic Rebuild Command ALTER INDEX Index_Name ON Table_Name REBUILD --REBUILD Index with ONLINE OPTION ALTER INDEX Index_Name ON Table_Name REBUILD WITH (ONLINE = ON) REORGANIZE INDEX The REORGANIZE INDEX command reorders the index page by expelling the free or unused space on the page. Ideally, index pages are reordered physically in the data file. REORGANIZE does not drop and create the index but simply restructures the information on the page. REORGANIZE does not have any offline choice, and REORGANIZE does not affect the statistics compared to the REBUILD option. REORGANIZE performs online always.\nALTER INDEX Index_Name ON Table_Name REORGANIZE SQL Server Index and Statistics Maintenance Link to Maintenance Solution: https://ola.hallengren.com/sql-server-index-and-statistics-maintenance.html\nIndexOptimize is the SQL Server Maintenance Solution’s stored procedure for rebuilding and reorganizing indexes and updating statistics. IndexOptimize is supported on SQL Server 2008, SQL Server 2008 R2, SQL Server 2012, SQL Server 2014, SQL Server 2016, SQL Server 2017, SQL Server 2019, Azure SQL Database, and Azure SQL Database Managed Instance.\nDownload MaintenanceSolution.sql. This script creates all the objects and jobs that you need. You can also download the objects as separate scripts. The SQL Server Maintenance Solution is available on GitHub.\n-- Rebuild or reorganize all indexes with fragmentation on database1 -- database2 and index more than 5% will be REORGANIZED and REBUILT -- whereas index more than 30% will only be REBUILT, update modified -- statistics and log the results to a table. EXECUTE dbo.IndexOptimize @Databases = 'database1, database2', @FragmentationLow = NULL, @FragmentationMedium = 'INDEX_REORGANIZE,INDEX_REBUILD_ONLINE,INDEX_REBUILD_OFFLINE', @FragmentationHigh = 'INDEX_REBUILD_ONLINE,INDEX_REBUILD_OFFLINE', @FragmentationLevel1 = 5, @FragmentationLevel2 = 30, @MinNumberOfPages = 1, @UpdateStatistics = 'ALL', @SortInTempdb = 'Y', @MaxDOP = 0, @LogToTable = 'Y' Databases Select databases. The hyphen character (-) is used to exclude databases, and the percent character (%) is used for wildcard selection. All of these operations can be combined by using the comma (,).\nValue Description SYSTEM_DATABASES All system databases (master, msdb, and model) USER_DATABASES All user databases ALL_DATABASES All databases AVAILABILITY_GROUP_DATABASES All databases in availability groups USER_DATABASES, AVAILABILITY_GROUP_DATABASES All user databases that are not in availability groups Db1 The database Db1 Db1, Db2 The databases Db1 and Db2 USER_DATABASES, -Db1 All user databases, except Db1 %Db% All databases that have “Db” in the name %Db%, -Db1 All databases that have “Db” in the name, except Db1 ALL_DATABASES, -%Db% All databases that do not have “Db” in the name FragmentationLow / FragmentationMedium / FragmentationHigh Specify index maintenance operations to be performed on a low/medium/high-fragmented index. An online index rebuild or an index reorganization is not always possible. Because of this, you can specify multiple index-maintenance operations for each fragmentation group. These operations are prioritized from left to right: If the first operation is supported for the index, then that operation is used; if the first operation is not supported, then the second operation is used (if supported), and so on. If none of the specified operations are supported for an index, then that index is not maintained.\nValue Description INDEX_REBUILD_ONLINE Rebuild index online. INDEX_REBUILD_OFFLINE Rebuild index offline. INDEX_REORGANIZE Reorganize index. INDEX_REBUILD_ONLINE, INDEX_REBUILD_OFFLINE Rebuild index online. Rebuild index offline if online rebuilding is not supported on an index. INDEX_REBUILD_ONLINE, INDEX_REORGANIZE Rebuild index online. Reorganize index if online rebuilding is not supported on an index. INDEX_REORGANIZE, INDEX_REBUILD_ONLINE, INDEX_REBUILD_OFFLINE Reorganize index. Rebuild index online if reorganizing is not supported on an index. Rebuild index offline if reorganizing and online rebuilding are not supported on an index FragmentationLevel1 / FragmentationLevel2 Set the lower limit, as a percentage, for medium fragmentation. The default is 5 percent.\nSet the lower limit, as a percentage, for high fragmentation. The default is 30 percent.\nThis is based on Microsoft’s recommendation in Books Online. IndexOptimize checks avg_fragmentation_in_percent in sys.dm_db_index_physical_stats to determine the fragmentation.\nMinNumberOfPages / MaxNumberOfPages Set a size, in pages; indexes with fewer pages are skipped for index maintenance. The default is 1000 pages. This is based on Microsoft’s recommendation.\nSet a size, in pages; indexes with a greater number of pages are skipped for index maintenance. The default is no limitation.\nIndexOptimize checks page_count in sys.dm_db_index_physical_stats to determine the size of the index.\nUpdateStatistics Value Description ALL Update index and column statistics. INDEX Update index statistics. COLUMNS Update column statistics. NULL Do not perform statistics maintenance. This is the default. SortInTempdb Use tempdb for sort operations when rebuilding indexes. The SortInTempdb option in IndexOptimize uses the SORT_IN_TEMPDB option in the SQL Server ALTER INDEX command. Values: Y and N (default N ).\nMaxDOP Specify the number of CPUs to use when rebuilding indexes. If this number is not specified, the global maximum degree of parallelism is used.\nThe MaxDOP option in IndexOptimize uses the MAXDOP option in the SQL Server ALTER INDEX command.\nLogToTable Log commands to the table dbo.CommandLog . Values: Y and N (default N ).\nSELECT CONCAT(DatabaseName, '.', SchemaName, '.', ObjectName) AS DatabaseSchemaObjectName, CASE WHEN ObjectType = 'U' THEN 'USER_TABLE' WHEN ObjectType = 'V' THEN 'VIEW' END AS ObjectType, IndexName, CASE WHEN IndexType = 1 THEN 'CLUSTERED' WHEN IndexType = 2 THEN 'NONCLUSTERED' WHEN IndexType = 3 THEN 'XML' WHEN IndexType = 4 THEN 'SPATIAL' END AS IndexType, ExtendedInfo.value('(ExtendedInfo/PageCount)[1]', 'int') AS [PageCount], ExtendedInfo.value('(ExtendedInfo/Fragmentation)[1]', 'float') AS Fragmentation, PartitionNumber, CommandType, Command, StartTime, EndTime, IIF( DATEDIFF(SS, StartTime, EndTime) / (24 * 3600) \u003e 0, CAST(DATEDIFF(SS, StartTime, EndTime) / (24 * 3600) AS NVARCHAR) + '.', '' ) + LEFT(CAST(DATEADD(MS, DATEDIFF(MS, StartTime, EndTime), 0) AS TIME), 12) AS Duration, ErrorNumber, ErrorMessage FROM dbo.CommandLog WHERE CommandType = 'ALTER_INDEX' ORDER BY DatabaseName; Reference https://www.sqlshack.com/how-to-identify-and-resolve-sql-server-index-fragmentation/ https://ola.hallengren.com/sql-server-index-and-statistics-maintenance.html ","wordCount":"1215","inLanguage":"en","datePublished":"2021-04-19T00:00:00Z","dateModified":"2021-04-19T00:00:00Z","author":{"@type":"Person","name":"Agus Fahmi Aji Pramana"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/blogs/tech/sql-index-monitoring-and-rebuilding/"},"publisher":{"@type":"Organization","name":"Agus Fahmi Aji Pramana's Blogging Site","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Agus Fahmi Aji Pramana (Alt + H)">Agus Fahmi Aji Pramana</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=http://localhost:1313/about-me title="About Me"><span>About Me</span></a></li><li><a href=http://localhost:1313/blogs title=Blogs><span>Blogs</span></a></li><li><a href=http://localhost:1313/projects title=Projects><span>Projects</span></a></li><li><a href=http://localhost:1313/slides title=Slides><span>Slides</span></a></li><li><a href=http://localhost:1313/honors title=Honors><span>Honors</span></a></li><li><a href=http://localhost:1313/search title="Search (Alt + /)" accesskey=/><i class="fa fa-search"></i></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/blogs/>Blogs</a>&nbsp;»&nbsp;<a href=http://localhost:1313/blogs/tech/>#tech</a></div><h1 class="post-title entry-hint-parent">SQL Index Monitoring and Rebuilding</h1><div class=post-description>Monitoring and Rebuilding Indexes in SQL</div><div class=post-meta><span title='2021-04-19 00:00:00 +0000 UTC'>April 19, 2021</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1215 words&nbsp;·&nbsp;Agus Fahmi Aji Pramana&nbsp;|&nbsp;<a href=https://github.com/agusfahmi/agusfahmiajipramana.com/tree/main/content/blogs/tech/sql-index-monitoring-and-rebuilding/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Agenda</span></summary><div class=inner><ul><li><a href=#index-fragmentation aria-label="Index Fragmentation">Index Fragmentation</a><ul><li><a href=#fragmentation-status-using-the-inbuilt-t-sql-statement aria-label="Fragmentation Status using the inbuilt T-SQL statement">Fragmentation Status using the inbuilt T-SQL statement</a></li><li><a href=#output aria-label=Output>Output</a></li><li><a href=#rebuild-index aria-label="REBUILD INDEX">REBUILD INDEX</a></li><li><a href=#reorganize-index aria-label="REORGANIZE INDEX">REORGANIZE INDEX</a></li><li><a href=#sql-server-index-and-statistics-maintenance aria-label="SQL Server Index and Statistics Maintenance">SQL Server Index and Statistics Maintenance</a><ul><li><a href=#databases aria-label=Databases>Databases</a></li><li><a href=#fragmentationlow--fragmentationmedium--fragmentationhigh aria-label="FragmentationLow / FragmentationMedium / FragmentationHigh">FragmentationLow / FragmentationMedium / FragmentationHigh</a></li><li><a href=#fragmentationlevel1--fragmentationlevel2 aria-label="FragmentationLevel1 / FragmentationLevel2">FragmentationLevel1 / FragmentationLevel2</a></li><li><a href=#minnumberofpages--maxnumberofpages aria-label="MinNumberOfPages / MaxNumberOfPages">MinNumberOfPages / MaxNumberOfPages</a></li><li><a href=#updatestatistics aria-label=UpdateStatistics>UpdateStatistics</a></li><li><a href=#sortintempdb aria-label=SortInTempdb>SortInTempdb</a></li><li><a href=#maxdop aria-label=MaxDOP>MaxDOP</a></li><li><a href=#logtotable aria-label=LogToTable>LogToTable</a></li></ul></li></ul></li><li><a href=#reference aria-label=Reference>Reference</a></li></ul></div></details></div><div class=post-content><h2 id=index-fragmentation>Index Fragmentation<a hidden class=anchor aria-hidden=true href=#index-fragmentation>#</a></h2><ul><li>Index Fragmentation percentage varies when the logical page orders don’t coordinate with the physical page order in the page allocation of an index.</li><li>With the data modification in the table, information can be resized on the data page.</li><li>Users can observe the disturbing page order with the massive delete operation on the table.</li><li>Along with the update and delete operations, the data page won’t be a top-full or empty page. Therefore, non-utilized free space raises the order mismatch between logical page and physical page with increasing the fragmentation, and that can cause worst query performance and consumes more server resources as well.</li><li>There can be a number of indexes created on a single table with the combination of various columns, and each index can have a different fragmentation percentage.</li></ul><h3 id=fragmentation-status-using-the-inbuilt-t-sql-statement>Fragmentation Status using the inbuilt T-SQL statement<a hidden class=anchor aria-hidden=true href=#fragmentation-status-using-the-inbuilt-t-sql-statement>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>S</span><span class=p>.</span><span class=n>name</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s1>&#39;Schema&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>T</span><span class=p>.</span><span class=n>name</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s1>&#39;Table&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>I</span><span class=p>.</span><span class=n>name</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s1>&#39;Index&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>DDIPS</span><span class=p>.</span><span class=n>avg_fragmentation_in_percent</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>DDIPS</span><span class=p>.</span><span class=n>page_count</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>sys</span><span class=p>.</span><span class=n>dm_db_index_physical_stats</span><span class=p>(</span><span class=n>DB_ID</span><span class=p>(),</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w> </span><span class=k>NULL</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>DDIPS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INNER</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>sys</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=n>T</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>T</span><span class=p>.</span><span class=n>object_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DDIPS</span><span class=p>.</span><span class=n>object_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INNER</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>sys</span><span class=p>.</span><span class=n>schemas</span><span class=w> </span><span class=n>S</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>T</span><span class=p>.</span><span class=n>schema_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>S</span><span class=p>.</span><span class=n>schema_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INNER</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>sys</span><span class=p>.</span><span class=n>indexes</span><span class=w> </span><span class=n>I</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>I</span><span class=p>.</span><span class=n>object_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DDIPS</span><span class=p>.</span><span class=n>object_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=n>DDIPS</span><span class=p>.</span><span class=n>index_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>I</span><span class=p>.</span><span class=n>index_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>DDIPS</span><span class=p>.</span><span class=n>database_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DB_ID</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=n>I</span><span class=p>.</span><span class=n>name</span><span class=w> </span><span class=k>IS</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=n>DDIPS</span><span class=p>.</span><span class=n>avg_fragmentation_in_percent</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>DDIPS</span><span class=p>.</span><span class=n>avg_fragmentation_in_percent</span><span class=w> </span><span class=k>DESC</span><span class=w>
</span></span></span></code></pre></div><h3 id=output>Output<a hidden class=anchor aria-hidden=true href=#output>#</a></h3><p><input type=checkbox id=zoomCheck-cf812 hidden>
<label for=zoomCheck-cf812><img class=zoomCheck loading=lazy decoding=async src=img/index-result.webp alt="Indexing Result"></label></p><p>Here, we can see the maximum fragmentation percentage is 94% in the local database right after loading
dummy data. To reduce this fragmentation, either of these can be performed in the database:</p><h3 id=rebuild-index>REBUILD INDEX<a hidden class=anchor aria-hidden=true href=#rebuild-index>#</a></h3><p>The INDEX REBUILD always drops the index and reproduces it with new index pages which runs with the ALTER INDEX command. This activity can be run in parallel using an online option which does not affect the running requests and tasks of a similar table. In the case of REBUILD INDEX offline, then the object resource of the
index won’t be accessible till the end of the REBUILD process completion.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>--Basic Rebuild Command
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ALTER</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>Index_Name</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>Table_Name</span><span class=w> </span><span class=n>REBUILD</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>--REBUILD Index with ONLINE OPTION
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>ALTER</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>Index_Name</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>Table_Name</span><span class=w> </span><span class=n>REBUILD</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=p>(</span><span class=n>ONLINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>ON</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><h3 id=reorganize-index>REORGANIZE INDEX<a hidden class=anchor aria-hidden=true href=#reorganize-index>#</a></h3><p>The REORGANIZE INDEX command reorders the index page by expelling the free or unused space on the page. Ideally, index pages are reordered physically in the data file. REORGANIZE does not drop and create the index but simply restructures the information on the page. REORGANIZE does not have any offline choice, and REORGANIZE does not affect the statistics compared to the REBUILD option. REORGANIZE performs online always.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>ALTER</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>Index_Name</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>Table_Name</span><span class=w> </span><span class=n>REORGANIZE</span><span class=w>
</span></span></span></code></pre></div><h3 id=sql-server-index-and-statistics-maintenance>SQL Server Index and Statistics Maintenance<a hidden class=anchor aria-hidden=true href=#sql-server-index-and-statistics-maintenance>#</a></h3><p>Link to Maintenance Solution: <a href=https://ola.hallengren.com/sql-server-index-and-statistics-maintenance.html>https://ola.hallengren.com/sql-server-index-and-statistics-maintenance.html</a></p><p>IndexOptimize is the SQL Server Maintenance Solution’s stored procedure for rebuilding and reorganizing indexes and updating statistics. IndexOptimize is supported on SQL Server 2008, SQL Server 2008 R2, SQL Server 2012, SQL Server 2014, SQL Server 2016, SQL Server 2017, SQL Server 2019, Azure SQL Database, and Azure SQL Database Managed Instance.</p><p>Download <a href=https://ola.hallengren.com/downloads.html>MaintenanceSolution.sql</a>. This script creates all the objects and jobs that you need. You can also download the objects as separate scripts. The SQL Server Maintenance Solution is available on GitHub.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- Rebuild or reorganize all indexes with fragmentation on database1
</span></span></span><span class=line><span class=cl><span class=c1>-- database2 and index more than 5% will be REORGANIZED and REBUILT
</span></span></span><span class=line><span class=cl><span class=c1>-- whereas index more than 30% will only be REBUILT, update modified
</span></span></span><span class=line><span class=cl><span class=c1>-- statistics and log the results to a table.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>EXECUTE</span><span class=w> </span><span class=n>dbo</span><span class=p>.</span><span class=n>IndexOptimize</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>@</span><span class=n>Databases</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;database1, database2&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>@</span><span class=n>FragmentationLow</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>@</span><span class=n>FragmentationMedium</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;INDEX_REORGANIZE,INDEX_REBUILD_ONLINE,INDEX_REBUILD_OFFLINE&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>@</span><span class=n>FragmentationHigh</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;INDEX_REBUILD_ONLINE,INDEX_REBUILD_OFFLINE&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>@</span><span class=n>FragmentationLevel1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>@</span><span class=n>FragmentationLevel2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>30</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>@</span><span class=n>MinNumberOfPages</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>@</span><span class=n>UpdateStatistics</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;ALL&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>@</span><span class=n>SortInTempdb</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Y&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>@</span><span class=n>MaxDOP</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>@</span><span class=n>LogToTable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Y&#39;</span><span class=w>
</span></span></span></code></pre></div><h4 id=databases>Databases<a hidden class=anchor aria-hidden=true href=#databases>#</a></h4><p>Select databases. The hyphen character (-) is used to exclude databases, and the percent character (%) is
used for wildcard selection. All of these operations can be combined by using the comma (,).</p><table><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>SYSTEM_DATABASES</td><td>All system databases (master, msdb, and model)</td></tr><tr><td>USER_DATABASES</td><td>All user databases</td></tr><tr><td>ALL_DATABASES</td><td>All databases</td></tr><tr><td>AVAILABILITY_GROUP_DATABASES</td><td>All databases in availability groups</td></tr><tr><td>USER_DATABASES, AVAILABILITY_GROUP_DATABASES</td><td>All user databases that are not in availability groups</td></tr><tr><td>Db1</td><td>The database Db1</td></tr><tr><td>Db1, Db2</td><td>The databases Db1 and Db2</td></tr><tr><td>USER_DATABASES, -Db1</td><td>All user databases, except Db1</td></tr><tr><td>%Db%</td><td>All databases that have “Db” in the name</td></tr><tr><td>%Db%, -Db1</td><td>All databases that have “Db” in the name, except Db1</td></tr><tr><td>ALL_DATABASES, -%Db%</td><td>All databases that do not have “Db” in the name</td></tr></tbody></table><h4 id=fragmentationlow--fragmentationmedium--fragmentationhigh>FragmentationLow / FragmentationMedium / FragmentationHigh<a hidden class=anchor aria-hidden=true href=#fragmentationlow--fragmentationmedium--fragmentationhigh>#</a></h4><p>Specify index maintenance operations to be performed on a low/medium/high-fragmented index. An online index rebuild or an index reorganization is not always possible. Because of this, you can specify multiple index-maintenance operations for each fragmentation group. These operations are prioritized from left to right: If the first operation is supported for the index, then that operation is used; if the first operation is not supported, then the second operation is used (if supported), and so on. If none of the specified operations are supported for an index, then that index is not maintained.</p><table><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>INDEX_REBUILD_ONLINE</td><td>Rebuild index online.</td></tr><tr><td>INDEX_REBUILD_OFFLINE</td><td>Rebuild index offline.</td></tr><tr><td>INDEX_REORGANIZE</td><td>Reorganize index.</td></tr><tr><td>INDEX_REBUILD_ONLINE, INDEX_REBUILD_OFFLINE</td><td>Rebuild index online. Rebuild index offline if online rebuilding is not supported on an index.</td></tr><tr><td>INDEX_REBUILD_ONLINE, INDEX_REORGANIZE</td><td>Rebuild index online. Reorganize index if online rebuilding is not supported on an index.</td></tr><tr><td>INDEX_REORGANIZE, INDEX_REBUILD_ONLINE, INDEX_REBUILD_OFFLINE</td><td>Reorganize index. Rebuild index online if reorganizing is not supported on an index. Rebuild index offline if reorganizing and online rebuilding are not supported on an index</td></tr></tbody></table><h4 id=fragmentationlevel1--fragmentationlevel2>FragmentationLevel1 / FragmentationLevel2<a hidden class=anchor aria-hidden=true href=#fragmentationlevel1--fragmentationlevel2>#</a></h4><p>Set the lower limit, as a percentage, for medium fragmentation. The default is 5 percent.</p><p>Set the lower limit, as a percentage, for high fragmentation. The default is 30 percent.</p><p>This is based on Microsoft’s recommendation in Books Online. IndexOptimize checks avg_fragmentation_in_percent in sys.dm_db_index_physical_stats to determine the fragmentation.</p><h4 id=minnumberofpages--maxnumberofpages>MinNumberOfPages / MaxNumberOfPages<a hidden class=anchor aria-hidden=true href=#minnumberofpages--maxnumberofpages>#</a></h4><p>Set a size, in pages; indexes with fewer pages are skipped for index maintenance. The default is 1000 pages. This is based on Microsoft’s recommendation.</p><p>Set a size, in pages; indexes with a greater number of pages are skipped for index maintenance. The default is no limitation.</p><p>IndexOptimize checks page_count in sys.dm_db_index_physical_stats to determine the size of the index.</p><h4 id=updatestatistics>UpdateStatistics<a hidden class=anchor aria-hidden=true href=#updatestatistics>#</a></h4><table><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>ALL</td><td>Update index and column statistics.</td></tr><tr><td>INDEX</td><td>Update index statistics.</td></tr><tr><td>COLUMNS</td><td>Update column statistics.</td></tr><tr><td>NULL</td><td>Do not perform statistics maintenance. This is the default.</td></tr></tbody></table><h4 id=sortintempdb>SortInTempdb<a hidden class=anchor aria-hidden=true href=#sortintempdb>#</a></h4><p>Use tempdb for sort operations when rebuilding indexes. The SortInTempdb option in IndexOptimize uses the SORT_IN_TEMPDB option in the SQL Server ALTER INDEX command. Values: Y and N (default N ).</p><h4 id=maxdop>MaxDOP<a hidden class=anchor aria-hidden=true href=#maxdop>#</a></h4><p>Specify the number of CPUs to use when rebuilding indexes. If this number is not specified, the global maximum degree of parallelism is used.</p><p>The MaxDOP option in IndexOptimize uses the MAXDOP option in the SQL Server ALTER INDEX command.</p><h4 id=logtotable>LogToTable<a hidden class=anchor aria-hidden=true href=#logtotable>#</a></h4><p>Log commands to the table dbo.CommandLog . Values: Y and N (default N ).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>CONCAT</span><span class=p>(</span><span class=n>DatabaseName</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;.&#39;</span><span class=p>,</span><span class=w> </span><span class=n>SchemaName</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;.&#39;</span><span class=p>,</span><span class=w> </span><span class=n>ObjectName</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>DatabaseSchemaObjectName</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>CASE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHEN</span><span class=w> </span><span class=n>ObjectType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;U&#39;</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=s1>&#39;USER_TABLE&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHEN</span><span class=w> </span><span class=n>ObjectType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;V&#39;</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=s1>&#39;VIEW&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>END</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>ObjectType</span><span class=p>,</span><span class=w> </span><span class=n>IndexName</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>CASE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHEN</span><span class=w> </span><span class=n>IndexType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=s1>&#39;CLUSTERED&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHEN</span><span class=w> </span><span class=n>IndexType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=s1>&#39;NONCLUSTERED&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHEN</span><span class=w> </span><span class=n>IndexType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=s1>&#39;XML&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHEN</span><span class=w> </span><span class=n>IndexType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=s1>&#39;SPATIAL&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>END</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>IndexType</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>ExtendedInfo</span><span class=p>.</span><span class=n>value</span><span class=p>(</span><span class=s1>&#39;(ExtendedInfo/PageCount)[1]&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;int&#39;</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>[</span><span class=n>PageCount</span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>ExtendedInfo</span><span class=p>.</span><span class=n>value</span><span class=p>(</span><span class=s1>&#39;(ExtendedInfo/Fragmentation)[1]&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;float&#39;</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>Fragmentation</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>PartitionNumber</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>CommandType</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>Command</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>StartTime</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>EndTime</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>IIF</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>DATEDIFF</span><span class=p>(</span><span class=n>SS</span><span class=p>,</span><span class=w> </span><span class=n>StartTime</span><span class=p>,</span><span class=w> </span><span class=n>EndTime</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=p>(</span><span class=mi>24</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>3600</span><span class=p>)</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>CAST</span><span class=p>(</span><span class=n>DATEDIFF</span><span class=p>(</span><span class=n>SS</span><span class=p>,</span><span class=w> </span><span class=n>StartTime</span><span class=p>,</span><span class=w> </span><span class=n>EndTime</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=p>(</span><span class=mi>24</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>3600</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>NVARCHAR</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;.&#39;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s1>&#39;&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=k>LEFT</span><span class=p>(</span><span class=k>CAST</span><span class=p>(</span><span class=n>DATEADD</span><span class=p>(</span><span class=n>MS</span><span class=p>,</span><span class=w> </span><span class=n>DATEDIFF</span><span class=p>(</span><span class=n>MS</span><span class=p>,</span><span class=w> </span><span class=n>StartTime</span><span class=p>,</span><span class=w> </span><span class=n>EndTime</span><span class=p>),</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>TIME</span><span class=p>),</span><span class=w> </span><span class=mi>12</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>Duration</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>ErrorNumber</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>ErrorMessage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>dbo</span><span class=p>.</span><span class=n>CommandLog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>CommandType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;ALTER_INDEX&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>DatabaseName</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h2 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h2><ul><li><a href=https://www.sqlshack.com/how-to-identify-and-resolve-sql-server-index-fragmentation/>https://www.sqlshack.com/how-to-identify-and-resolve-sql-server-index-fragmentation/</a></li><li><a href=https://ola.hallengren.com/sql-server-index-and-statistics-maintenance.html>https://ola.hallengren.com/sql-server-index-and-statistics-maintenance.html</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/sql/>Sql</a></li><li><a href=http://localhost:1313/tags/indexing/>Indexing</a></li></ul><nav class=paginav><a class=prev href=http://localhost:1313/blogs/tech/http-security-with-csp-headers/><span class=title>« Prev</span><br><span>HTTP Security with Content-Security-Policy headers</span>
</a><a class=next href=http://localhost:1313/blogs/tech/sql-benchmarking/><span class=title>Next »</span><br><span>SQL performance benchmarking queries</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share SQL Index Monitoring and Rebuilding on x" href="https://x.com/intent/tweet/?text=SQL%20Index%20Monitoring%20and%20Rebuilding&amp;url=http%3a%2f%2flocalhost%3a1313%2fblogs%2ftech%2fsql-index-monitoring-and-rebuilding%2f&amp;hashtags=sql%2cindexing"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share SQL Index Monitoring and Rebuilding on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fblogs%2ftech%2fsql-index-monitoring-and-rebuilding%2f&amp;title=SQL%20Index%20Monitoring%20and%20Rebuilding&amp;summary=SQL%20Index%20Monitoring%20and%20Rebuilding&amp;source=http%3a%2f%2flocalhost%3a1313%2fblogs%2ftech%2fsql-index-monitoring-and-rebuilding%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share SQL Index Monitoring and Rebuilding on reddit" href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fblogs%2ftech%2fsql-index-monitoring-and-rebuilding%2f&title=SQL%20Index%20Monitoring%20and%20Rebuilding"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share SQL Index Monitoring and Rebuilding on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fblogs%2ftech%2fsql-index-monitoring-and-rebuilding%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share SQL Index Monitoring and Rebuilding on whatsapp" href="https://api.whatsapp.com/send?text=SQL%20Index%20Monitoring%20and%20Rebuilding%20-%20http%3a%2f%2flocalhost%3a1313%2fblogs%2ftech%2fsql-index-monitoring-and-rebuilding%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share SQL Index Monitoring and Rebuilding on telegram" href="https://telegram.me/share/url?text=SQL%20Index%20Monitoring%20and%20Rebuilding&amp;url=http%3a%2f%2flocalhost%3a1313%2fblogs%2ftech%2fsql-index-monitoring-and-rebuilding%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li></ul></footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//agusfahmiajipramana-com.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy;
2025
<a href=http://localhost:1313/>Agus Fahmi Aji Pramana's Blogging Site</a></span>
| <span><a href=/terms-and-conditions>Terms and Conditions</a>
</span>|
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a>
&
      <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span><br></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})}),document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".project");e.forEach(function(e){e.addEventListener("click",function(t){t.target.closest(".small-icons")||window.open(e.getAttribute("data-project-link"),"_blank").focus()})})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>